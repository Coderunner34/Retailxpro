<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailPro Kenya | Complete Business Management</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‡°ðŸ‡ª</text></svg>">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css">
    
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    
    <!-- Custom Styles -->
    <style>
        /* [Previous CSS styles remain unchanged...] */

        /* Enhanced Dashboard Styles */
        .kpi-card {
            @apply bg-white dark:bg-gray-800 rounded-lg shadow p-4 flex items-center;
            transition: all 0.3s ease;
        }
        
        .kpi-card:hover {
            @apply shadow-lg transform scale-105;
        }
        
        .kpi-icon {
            @apply rounded-full p-3 mr-4;
        }
        
        /* POS Styles */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
        }
        
        .product-card {
            @apply bg-white dark:bg-gray-800 rounded-lg shadow p-3 cursor-pointer transition-all;
        }
        
        .product-card:hover {
            @apply shadow-md transform scale-105;
        }
        
        .product-card:active {
            @apply transform scale-95;
        }
        
        /* Inventory Styles */
        .inventory-table th {
            @apply sticky top-0 bg-gray-100 dark:bg-gray-700 z-10;
        }
        
        /* Receipt Styles */
        .receipt-item {
            @apply border-b border-gray-200 dark:border-gray-700 py-2;
        }
        
        /* M-Pesa Modal Styles */
        .mpesa-input {
            @apply w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg text-lg font-semibold text-center;
        }
        
        /* Barcode Styles */
        .barcode {
            font-family: 'Libre Barcode 128', cursive;
            font-size: 2rem;
        }
    </style>
    
    <!-- Alpine JS -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- QuaggaJS (Barcode Scanner) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    
    <!-- FileSaver.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- SheetJS (Excel Export) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Barcode Font -->
    <link href="https://fonts.googleapis.com/css2?family=Libre+Barcode+128&display=swap" rel="stylesheet">
</head>

<body class="h-full bg-gray-50 text-gray-900 font-inter dark:bg-gray-900 dark:text-gray-100 transition-colors"
      x-data="retailApp()"
      x-init="init()"
      :class="{'overflow-hidden': showModal}">
    
    <!-- Loading Overlay -->
    <div x-show="isLoading" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center transition-opacity">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
    </div>

    <!-- Offline Indicator -->
    <div x-show="!isOnline" class="fixed top-0 left-0 right-0 bg-red-500 text-white text-center py-2 text-sm z-40">
        <i class="fas fa-wifi-slash mr-2"></i>
        <span x-text="language === 'sw' ? 'Huna mtandao - Data imehifadhiwa kimtaji' : 'Offline - Data saved locally'"></span>
    </div>

    <!-- Notification System -->
    <div id="notifications" class="fixed top-4 right-4 z-40 space-y-2 w-80"></div>

    <!-- Authentication Screen -->
    <div x-show="!isAuthenticated" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 to-purple-700 p-4">
        <div class="w-full max-w-md">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl overflow-hidden transition-all transform">
                <div class="p-8">
                    <div class="flex justify-center mb-6">
                        <div class="kenyan-flag w-16 h-10 rounded-md mr-3"></div>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">RetailPro Kenya</h1>
                    </div>
                    
                    <form @submit.prevent="login()" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Nambari ya Simu' : 'Phone Number'"></label>
                            <input x-model="loginForm.phone" type="tel" placeholder="+254700000000" required
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Nenosiri' : 'Password'"></label>
                            <input x-model="loginForm.password" type="password" required
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="remember-me" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600">
                                <label for="remember-me" class="ml-2 block text-sm text-gray-700 dark:text-gray-300" x-text="language === 'sw' ? 'Nikumbuke' : 'Remember me'"></label>
                            </div>
                            
                            <div class="text-sm">
                                <a href="#" class="font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400" x-text="language === 'sw' ? 'Umesahau nenosiri?' : 'Forgot password?'"></a>
                            </div>
                        </div>
                        
                        <div>
                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                                <span x-show="!isLoggingIn" x-text="language === 'sw' ? 'Ingia' : 'Sign In'"></span>
                                <span x-show="isLoggingIn" x-text="language === 'sw' ? 'Inaingiza...' : 'Signing In...'"></span>
                            </button>
                        </div>
                    </form>
                    
                    <div class="mt-6">
                        <div class="relative">
                            <div class="absolute inset-0 flex items-center">
                                <div class="w-full border-t border-gray-300 dark:border-gray-600"></div>
                            </div>
                            <div class="relative flex justify-center text-sm">
                                <span class="px-2 bg-white dark:bg-gray-800 text-gray-500" x-text="language === 'sw' ? 'Au ingia kwa' : 'Or sign in with'"></span>
                            </div>
                        </div>
                        
                        <div class="mt-6 grid grid-cols-2 gap-3">
                            <button type="button" class="w-full inline-flex justify-center items-center py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm bg-white dark:bg-gray-700 text-sm font-medium text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600">
                                <i class="fab fa-google text-red-500 mr-2"></i>
                                <span x-text="language === 'sw' ? 'Google' : 'Google'"></span>
                            </button>
                            
                            <button type="button" class="w-full inline-flex justify-center items-center py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm bg-white dark:bg-gray-700 text-sm font-medium text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600">
                                <i class="fab fa-microsoft text-blue-500 mr-2"></i>
                                <span x-text="language === 'sw' ? 'Microsoft' : 'Microsoft'"></span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="px-8 py-4 bg-gray-50 dark:bg-gray-700 text-center text-sm border-t border-gray-200 dark:border-gray-600">
                    <p class="text-gray-600 dark:text-gray-300">
                        <span x-text="language === 'sw' ? 'Huna akaunti?' : 'Don\'t have an account?'"></span>{' '}
                        <a href="#" class="font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400" x-text="language === 'sw' ? 'Omba upatikanaji' : 'Request access'"></a>
                    </p>
                </div>
            </div>
            
            <div class="mt-6 text-center text-sm text-white">
                <p x-text="language === 'sw' ? 'Â© RetailPro Kenya. Haki zote zimehifadhiwa.' : 'Â© RetailPro Kenya. All rights reserved.'"></p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div x-show="isAuthenticated" class="min-h-screen flex flex-col">
        <!-- Top Navigation -->
        <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
            <div class="px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <!-- Mobile menu button -->
                        <button @click="mobileMenuOpen = !mobileMenuOpen" class="md:hidden text-gray-500 dark:text-gray-400 mr-2">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        
                        <!-- Logo -->
                        <div class="flex items-center">
                            <div class="kenyan-flag w-8 h-5 rounded mr-2"></div>
                            <span class="text-xl font-bold text-gray-900 dark:text-white">RetailPro</span>
                        </div>
                        
                        <!-- Desktop Navigation -->
                        <nav class="hidden md:flex ml-10 space-x-4">
                            <template x-for="item in navigationItems" :key="item.id">
                                <a @click="currentView = item.id" 
                                   :class="currentView === item.id ? 'bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'"
                                   class="group flex items-center px-3 py-2 text-sm font-medium rounded-md cursor-pointer transition-colors">
                                    <i :class="item.icon" class="mr-2"></i>
                                    <span x-text="language === 'sw' ? item.nameSwahili : item.name"></span>
                                </a>
                            </template>
                        </nav>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- Quick Actions -->
                        <template x-if="currentView === 'pos'">
                            <div class="flex space-x-2">
                                <button @click="openBarcodeScanner()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    <i class="fas fa-barcode mr-2"></i>
                                    <span x-text="language === 'sw' ? 'Changanua' : 'Scan'"></span>
                                </button>
                                <button @click="showKeyboardShortcuts = true" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    <i class="fas fa-keyboard mr-2"></i>
                                    <span x-text="language === 'sw' ? 'Vifungo' : 'Shortcuts'"></span>
                                </button>
                            </div>
                        </template>
                        
                        <!-- Branch Selector -->
                        <div x-show="branches.length > 1" class="relative">
                            <button @click="branchMenuOpen = !branchMenuOpen" class="flex items-center space-x-1 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-lg">
                                <i class="fas fa-store text-blue-500"></i>
                                <span class="text-sm font-medium" x-text="currentBranch.name"></span>
                                <i class="fas fa-chevron-down text-xs ml-1"></i>
                            </button>
                            
                            <div x-show="branchMenuOpen" @click.away="branchMenuOpen = false" 
                                 class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none z-50">
                                <div class="py-1">
                                    <template x-for="branch in branches" :key="branch.id">
                                        <a href="#" @click="switchBranch(branch.id)" 
                                           :class="{'bg-gray-100 dark:bg-gray-700': currentBranch.id === branch.id}"
                                           class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                            <span x-text="branch.name"></span>
                                        </a>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <!-- User Menu -->
                        <div class="relative ml-3">
                            <button @click="userMenuOpen = !userMenuOpen" class="flex items-center space-x-2">
                                <div class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium" x-text="user.name.charAt(0)"></div>
                                <span class="hidden md:inline text-sm font-medium" x-text="user.name"></span>
                            </button>
                            
                            <!-- User Dropdown -->
                            <div x-show="userMenuOpen" @click.away="userMenuOpen = false" 
                                 class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none z-50">
                                <div class="py-1">
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" x-text="language === 'sw' ? 'Mipangilio ya Profaili' : 'Profile Settings'"></a>
                                    <a href="#" @click="toggleTheme()" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <span x-text="language === 'sw' ? (darkMode ? 'Mwangaza' : 'Giza') : (darkMode ? 'Light Mode' : 'Dark Mode')"></span>
                                    </a>
                                    <a href="#" @click="toggleLanguage()" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <span x-text="language === 'sw' ? 'Badilisha Lugha' : 'Change Language'"></span>
                                    </a>
                                    <a href="#" @click="logout()" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" x-text="language === 'sw' ? 'Toka' : 'Sign Out'"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Navigation -->
            <div x-show="mobileMenuOpen" class="md:hidden">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <template x-for="item in navigationItems" :key="item.id">
                        <a @click="currentView = item.id; mobileMenuOpen = false" 
                           :class="currentView === item.id ? 'bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-300' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'"
                           class="group flex items-center px-3 py-2 text-sm font-medium rounded-md cursor-pointer transition-colors">
                            <i :class="item.icon" class="mr-2"></i>
                            <span x-text="language === 'sw' ? item.nameSwahili : item.name"></span>
                        </a>
                    </template>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-auto">
            <!-- Dashboard View -->
            <div x-show="currentView === 'dashboard'" class="p-6 animate-fade-in">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold" x-text="language === 'sw' ? 'Dashibodi' : 'Dashboard'"></h2>
                    <div class="flex space-x-2">
                        <button @click="refreshDashboard()" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded-lg">
                            <i class="fas fa-sync-alt mr-2"></i>
                            <span x-text="language === 'sw' ? 'Sasisha' : 'Refresh'"></span>
                        </button>
                        <button @click="exportDashboardData()" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded-lg">
                            <i class="fas fa-file-export mr-2"></i>
                            <span x-text="language === 'sw' ? 'Hamisha' : 'Export'"></span>
                        </button>
                    </div>
                </div>
                
                <!-- KPIs -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-blue-100 text-blue-600 dark:bg-blue-900 dark:text-blue-200">
                            <i class="fas fa-money-bill-wave text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400" x-text="language === 'sw' ? 'Mauzo ya Leo' : 'Today\'s Sales'"></p>
                            <p class="text-2xl font-bold" x-text="formatCurrency(dashboardData.todaySales)"></p>
                            <p class="text-xs" :class="{'text-green-500': dashboardData.salesChange >= 0, 'text-red-500': dashboardData.salesChange < 0}">
                                <span x-text="dashboardData.salesChange >= 0 ? 'â†‘' : 'â†“'"></span>
                                <span x-text="Math.abs(dashboardData.salesChange) + '%'"></span>
                                <span x-text="language === 'sw' ? 'kutoka jana' : 'from yesterday'"></span>
                            </p>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-icon bg-green-100 text-green-600 dark:bg-green-900 dark:text-green-200">
                            <i class="fas fa-shopping-cart text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400" x-text="language === 'sw' ? 'Maagizo ya Leo' : 'Today\'s Orders'"></p>
                            <p class="text-2xl font-bold" x-text="dashboardData.todayOrders"></p>
                            <p class="text-xs" :class="{'text-green-500': dashboardData.ordersChange >= 0, 'text-red-500': dashboardData.ordersChange < 0}">
                                <span x-text="dashboardData.ordersChange >= 0 ? 'â†‘' : 'â†“'"></span>
                                <span x-text="Math.abs(dashboardData.ordersChange) + '%'"></span>
                                <span x-text="language === 'sw' ? 'kutoka jana' : 'from yesterday'"></span>
                            </p>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-icon bg-yellow-100 text-yellow-600 dark:bg-yellow-900 dark:text-yellow-200">
                            <i class="fas fa-boxes text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400" x-text="language === 'sw' ? 'Bidhaa Zilizokaribia Kuisha' : 'Low Stock Items'"></p>
                            <p class="text-2xl font-bold" x-text="dashboardData.lowStockItems"></p>
                            <p class="text-xs text-gray-500 dark:text-gray-400" x-text="language === 'sw' ? 'chini ya kiwango cha chini' : 'below threshold'"></p>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-icon bg-purple-100 text-purple-600 dark:bg-purple-900 dark:text-purple-200">
                            <i class="fas fa-users text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400" x-text="language === 'sw' ? 'Wateja Wapya' : 'New Customers'"></p>
                            <p class="text-2xl font-bold" x-text="dashboardData.newCustomers"></p>
                            <p class="text-xs" :class="{'text-green-500': dashboardData.customersChange >= 0, 'text-red-500': dashboardData.customersChange < 0}">
                                <span x-text="dashboardData.customersChange >= 0 ? 'â†‘' : 'â†“'"></span>
                                <span x-text="Math.abs(dashboardData.customersChange) + '%'"></span>
                                <span x-text="language === 'sw' ? 'kutoka mwezi uliopita' : 'from last month'"></span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Sales Chart -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-semibold" x-text="language === 'sw' ? 'Mauzo ya Mwezi Huu' : 'This Month Sales'"></h3>
                            <select x-model="salesChartRange" @change="updateSalesChart()" class="text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700">
                                <option value="7" x-text="language === 'sw' ? 'Wiki 1' : '1 Week'"></option>
                                <option value="30" x-text="language === 'sw' ? 'Mwezi 1' : '1 Month'"></option>
                                <option value="90" x-text="language === 'sw' ? 'Miezi 3' : '3 Months'"></option>
                            </select>
                        </div>
                        <div class="h-64">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Inventory Chart -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-semibold" x-text="language === 'sw' ? 'Hifadhi kwa Kundi' : 'Inventory by Category'"></h3>
                            <button @click="refreshInventoryChart()" class="text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-2 py-1 rounded">
                                <i class="fas fa-sync-alt mr-1"></i>
                                <span x-text="language === 'sw' ? 'Sasisha' : 'Refresh'"></span>
                            </button>
                        </div>
                        <div class="h-64">
                            <canvas id="inventoryChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Transactions -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                    <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                        <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Manunuzi ya Hivi Karibuni' : 'Recent Transactions'"></h3>
                        <a href="#" @click="currentView = 'reports'" class="text-sm text-blue-600 hover:text-blue-500 dark:text-blue-400" x-text="language === 'sw' ? 'Tazama zote' : 'View all'"></a>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Nambari ya Manunuzi' : 'Receipt No'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Mteja' : 'Customer'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Tarehe' : 'Date'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Kiasi' : 'Amount'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Malipo' : 'Payment'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Hali' : 'Status'"></th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <template x-for="transaction in recentTransactions" :key="transaction.id">
                                    <tr @click="viewTransaction(transaction.id)" class="hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white" x-text="transaction.receiptNo"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="transaction.customer || (language === 'sw' ? 'Mteja wa Kawaida' : 'Walk-in Customer')"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatDate(transaction.date, true)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatCurrency(transaction.amount)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" 
                                                  :class="{'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200': transaction.paymentMethod === 'mpesa',
                                                           'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200': transaction.paymentMethod === 'cash',
                                                           'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200': transaction.paymentMethod === 'card'}">
                                                <span x-text="language === 'sw' ? 
                                                    (transaction.paymentMethod === 'mpesa' ? 'M-Pesa' : 
                                                     transaction.paymentMethod === 'cash' ? 'Pesa Taslimu' : 'Kadi') 
                                                    : transaction.paymentMethod.toUpperCase()"></span>
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" 
                                                  :class="{'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200': transaction.status === 'completed',
                                                           'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200': transaction.status === 'pending',
                                                           'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200': transaction.status === 'cancelled'}">
                                                <span x-text="language === 'sw' ? 
                                                    (transaction.status === 'completed' ? 'Imekamilika' : 
                                                     transaction.status === 'pending' ? 'Inasubiri' : 'Imeshindwa') 
                                                    : transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1)"></span>
                                            </span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- POS View -->
            <div x-show="currentView === 'pos'" class="h-full flex flex-col">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 h-full p-4">
                    <!-- Product Selection -->
                    <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden flex flex-col">
                        <div class="border-b border-gray-200 dark:border-gray-700 p-4">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-medium" x-text="language === 'sw' ? 'Chagua Bidhaa' : 'Select Products'"></h3>
                                <div class="relative w-64">
                                    <input type="text" x-model="productSearch" @input="searchProducts()" 
                                           :placeholder="language === 'sw' ? 'Tafuta bidhaa...' : 'Search products...'"
                                           class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    <div class="absolute left-3 top-2.5 text-gray-400 dark:text-gray-500">
                                        <i class="fas fa-search"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4 flex space-x-2 overflow-x-auto pb-2">
                                <button @click="setActiveCategory(null)" 
                                        :class="{'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200': activeCategory === null}"
                                        class="px-3 py-1 rounded-full text-sm font-medium bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                    <span x-text="language === 'sw' ? 'Zote' : 'All'"></span>
                                </button>
                                <template x-for="category in productCategories" :key="category">
                                    <button @click="setActiveCategory(category)" 
                                            :class="{'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200': activeCategory === category}"
                                            class="px-3 py-1 rounded-full text-sm font-medium bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors whitespace-nowrap">
                                        <span x-text="category"></span>
                                    </button>
                                </template>
                            </div>
                        </div>
                        
                        <div class="flex-1 overflow-y-auto p-4">
                            <div class="product-grid">
                                <template x-for="product in filteredProducts" :key="product.id">
                                    <div @click="addToCart(product)" class="product-card">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="font-medium" x-text="product.name"></h4>
                                                <p class="text-sm text-gray-500 dark:text-gray-400" x-text="product.category"></p>
                                            </div>
                                            <div class="text-right">
                                                <p class="font-semibold" x-text="formatCurrency(product.price)"></p>
                                                <p class="text-xs" :class="{'text-green-500': product.stock > 10, 'text-yellow-500': product.stock > 0 && product.stock <= 10, 'text-red-500': product.stock <= 0}">
                                                    <span x-text="product.stock > 0 ? product.stock + (language === 'sw' ? ' zimesalia' : ' in stock') : (language === 'sw' ? 'Imekwisha' : 'Out of stock')"></span>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="mt-2 flex justify-between items-center">
                                            <span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded" x-text="product.sku"></span>
                                            <div class="barcode" x-text="product.barcode"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cart & Checkout -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden flex flex-col">
                        <div class="border-b border-gray-200 dark:border-gray-700 p-4">
                            <h3 class="text-lg font-medium" x-text="language === 'sw' ? 'Rekodi ya Manunuzi' : 'Purchase Record'"></h3>
                        </div>
                        
                        <div class="flex-1 overflow-y-auto p-4">
                            <template x-if="cart.length === 0">
                                <div class="h-full flex flex-col items-center justify-center text-gray-400 dark:text-gray-500">
                                    <i class="fas fa-shopping-cart text-4xl mb-4"></i>
                                    <p x-text="language === 'sw' ? 'Hakuna bidhaa kwenye kikapu' : 'No products in cart'"></p>
                                </div>
                            </template>
                            
                            <template x-if="cart.length > 0">
                                <div class="space-y-3">
                                    <template x-for="(item, index) in cart" :key="index">
                                        <div class="flex justify-between items-start p-2 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                            <div class="flex-1">
                                                <div class="flex justify-between">
                                                    <h4 class="font-medium" x-text="item.product.name"></h4>
                                                    <p class="font-semibold" x-text="formatCurrency(item.product.price * item.quantity)"></p>
                                                </div>
                                                <div class="flex items-center mt-1">
                                                    <button @click.stop="updateQuantity(index, item.quantity - 1)" 
                                                            class="w-8 h-8 flex items-center justify-center bg-gray-200 dark:bg-gray-600 rounded-l hover:bg-gray-300 dark:hover:bg-gray-500">
                                                        <i class="fas fa-minus text-xs"></i>
                                                    </button>
                                                    <input type="number" x-model="item.quantity" @change="validateQuantity(index)" 
                                                           class="w-12 h-8 text-center border-t border-b border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                                                    <button @click.stop="updateQuantity(index, item.quantity + 1)" 
                                                            class="w-8 h-8 flex items-center justify-center bg-gray-200 dark:bg-gray-600 rounded-r hover:bg-gray-300 dark:hover:bg-gray-500">
                                                        <i class="fas fa-plus text-xs"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <button @click.stop="removeFromCart(index)" class="ml-2 text-red-500 hover:text-red-700 dark:hover:text-red-400">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                        
                        <div class="border-t border-gray-200 dark:border-gray-700 p-4">
                            <div class="space-y-2 mb-4">
                                <div class="flex justify-between">
                                    <span x-text="language === 'sw' ? 'Jumla' : 'Subtotal'"></span>
                                    <span x-text="formatCurrency(cartTotal)"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span x-text="language === 'sw' ? 'Kodi' : 'Tax'"></span>
                                    <span x-text="formatCurrency(cartTax)"></span>
                                </div>
                                <div class="flex justify-between font-bold text-lg">
                                    <span x-text="language === 'sw' ? 'Jumla ya Malipo' : 'Total Payment'"></span>
                                    <span x-text="formatCurrency(cartTotal + cartTax)"></span>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Mteja' : 'Customer'"></label>
                                <div class="relative">
                                    <input type="text" x-model="customerSearch" @input="searchCustomers()" 
                                           :placeholder="language === 'sw' ? 'Tafuta mteja...' : 'Search customer...'"
                                           class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    <div class="absolute left-3 top-2.5 text-gray-400 dark:text-gray-500">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <button @click="showCustomerModal = true" class="absolute right-3 top-2.5 text-blue-500 hover:text-blue-700 dark:hover:text-blue-400">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div x-show="filteredCustomers.length > 0 && customerSearch" class="mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-40 overflow-y-auto z-10">
                                    <template x-for="customer in filteredCustomers" :key="customer.id">
                                        <div @click="selectCustomer(customer)" class="px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer">
                                            <p class="font-medium" x-text="customer.name"></p>
                                            <p class="text-sm text-gray-500 dark:text-gray-400" x-text="customer.phone"></p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-2 mb-4">
                                <button @click="applyDiscount(5)" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 py-2 rounded-lg">
                                    <span class="text-xs block">5%</span>
                                    <span class="text-xs" x-text="language === 'sw' ? 'Punguzo' : 'Discount'"></span>
                                </button>
                                <button @click="applyDiscount(10)" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 py-2 rounded-lg">
                                    <span class="text-xs block">10%</span>
                                    <span class="text-xs" x-text="language === 'sw' ? 'Punguzo' : 'Discount'"></span>
                                </button>
                                <button @click="applyDiscount(15)" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 py-2 rounded-lg">
                                    <span class="text-xs block">15%</span>
                                    <span class="text-xs" x-text="language === 'sw' ? 'Punguzo' : 'Discount'"></span>
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-2">
                                <button @click="processPayment('cash')" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                                    <i class="fas fa-money-bill-wave mr-2"></i>
                                    <span x-text="language === 'sw' ? 'Pesa Taslimu' : 'Cash'"></span>
                                </button>
                                <button @click="processPayment('mpesa')" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                                    <i class="fas fa-mobile-alt mr-2"></i>
                                    <span>M-Pesa</span>
                                </button>
                                <button @click="processPayment('card')" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                                    <i class="fas fa-credit-card mr-2"></i>
                                    <span x-text="language === 'sw' ? 'Kadi' : 'Card'"></span>
                                </button>
                                <button @click="clearCart()" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                                    <i class="fas fa-trash mr-2"></i>
                                    <span x-text="language === 'sw' ? 'Futa Yote' : 'Clear All'"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory View -->
            <div x-show="currentView === 'inventory'" class="p-6 animate-fade-in">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold" x-text="language === 'sw' ? 'Usimamizi wa Hifadhi' : 'Inventory Management'"></h2>
                    <div class="flex space-x-2">
                        <button @click="showImportModal = true" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded-lg">
                            <i class="fas fa-file-import mr-2"></i>
                            <span x-text="language === 'sw' ? 'Ingiza' : 'Import'"></span>
                        </button>
                        <button @click="exportInventory()" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded-lg">
                            <i class="fas fa-file-export mr-2"></i>
                            <span x-text="language === 'sw' ? 'Hamisha' : 'Export'"></span>
                        </button>
                        <button @click="showAddProductModal = true" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg">
                            <i class="fas fa-plus mr-2"></i>
                            <span x-text="language === 'sw' ? 'Bidhaa Mpya' : 'New Product'"></span>
                        </button>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden mb-6">
                    <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Bidhaa Zote' : 'All Products'"></h3>
                            <div class="relative w-64">
                                <input type="text" x-model="inventorySearch" @input="searchInventory()" 
                                       :placeholder="language === 'sw' ? 'Tafuta bidhaa...' : 'Search products...'"
                                       class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                <div class="absolute left-3 top-2.5 text-gray-400 dark:text-gray-500">
                                    <i class="fas fa-search"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 inventory-table">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Jina' : 'Name'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'SKU' : 'SKU'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Kundi' : 'Category'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Bei' : 'Price'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Hifadhi' : 'Stock'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Thamani' : 'Value'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Vitendo' : 'Actions'"></th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <template x-for="product in filteredInventory" :key="product.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 h-10 w-10 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center overflow-hidden">
                                                    <template x-if="product.image">
                                                        <img :src="product.image" class="h-full w-full object-cover">
                                                    </template>
                                                    <template x-if="!product.image">
                                                        <i class="fas fa-box text-gray-400 dark:text-gray-500"></i>
                                                    </template>
                                                </div>
                                                <div class="ml-4">
                                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="product.name"></div>
                                                    <div class="text-sm text-gray-500 dark:text-gray-400" x-text="product.barcode"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="product.sku"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="product.category"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatCurrency(product.price)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full" 
                                                  :class="{'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200': product.stock > 10,
                                                           'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200': product.stock > 0 && product.stock <= 10,
                                                           'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200': product.stock <= 0}">
                                                <span x-text="product.stock"></span>
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatCurrency(product.price * product.stock)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button @click="editProduct(product)" class="text-blue-600 hover:text-blue-900 dark:hover:text-blue-400 mr-3">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button @click="deleteProduct(product.id)" class="text-red-600 hover:text-red-900 dark:hover:text-red-400">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                    <div class="px-4 py-3 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600 flex items-center justify-between">
                        <div class="flex-1 flex justify-between items-center">
                            <button @click="prevInventoryPage()" :disabled="inventoryPage === 1" 
                                    :class="{'opacity-50 cursor-not-allowed': inventoryPage === 1}"
                                    class="relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
                                <span x-text="language === 'sw' ? 'Awali' : 'Previous'"></span>
                            </button>
                            <span class="text-sm text-gray-700 dark:text-gray-300">
                                <span x-text="language === 'sw' ? 'Kurasa' : 'Page'"></span> 
                                <span x-text="inventoryPage"></span> 
                                <span x-text="language === 'sw' ? 'ya' : 'of'"></span> 
                                <span x-text="Math.ceil(filteredInventory.length / inventoryPageSize)"></span>
                            </span>
                            <button @click="nextInventoryPage()" 
                                    :disabled="inventoryPage * inventoryPageSize >= filteredInventory.length"
                                    :class="{'opacity-50 cursor-not-allowed': inventoryPage * inventoryPageSize >= filteredInventory.length}"
                                    class="relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
                                <span x-text="language === 'sw' ? 'Ijayo' : 'Next'"></span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Low Stock Alert -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                    <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Bidhaa Zilizokaribia Kuisha' : 'Low Stock Items'"></h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Jina' : 'Name'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'SKU' : 'SKU'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Hifadhi ya Sasa' : 'Current Stock'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Kiwango cha Chini' : 'Minimum Level'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Vitendo' : 'Actions'"></th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <template x-for="product in lowStockItems" :key="product.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="product.name"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="product.sku"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="product.stock"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="product.minStock || 5"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button @click="restockProduct(product)" class="text-blue-600 hover:text-blue-900 dark:hover:text-blue-400">
                                                <i class="fas fa-plus-circle mr-1"></i>
                                                <span x-text="language === 'sw' ? 'Rejesha' : 'Restock'"></span>
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Customers View -->
            <div x-show="currentView === 'customers'" class="p-6 animate-fade-in">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold" x-text="language === 'sw' ? 'Usimamizi wa Wateja' : 'Customer Management'"></h2>
                    <div class="flex space-x-2">
                        <button @click="exportCustomers()" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded-lg">
                            <i class="fas fa-file-export mr-2"></i>
                            <span x-text="language === 'sw' ? 'Hamisha' : 'Export'"></span>
                        </button>
                        <button @click="showAddCustomerModal = true" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg">
                            <i class="fas fa-plus mr-2"></i>
                            <span x-text="language === 'sw' ? 'Mteja Mpya' : 'New Customer'"></span>
                        </button>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden mb-6">
                    <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Wateja Wote' : 'All Customers'"></h3>
                            <div class="relative w-64">
                                <input type="text" x-model="customerListSearch" @input="searchCustomerList()" 
                                       :placeholder="language === 'sw' ? 'Tafuta mteja...' : 'Search customer...'"
                                       class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                <div class="absolute left-3 top-2.5 text-gray-400 dark:text-gray-500">
                                    <i class="fas fa-search"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Jina' : 'Name'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Simu' : 'Phone'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Barua Pepe' : 'Email'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Manunuzi' : 'Purchases'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Jumla ya Matumizi' : 'Total Spent'"></th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Vitendo' : 'Actions'"></th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <template x-for="customer in filteredCustomerList" :key="customer.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium" x-text="customer.name.charAt(0)"></div>
                                                <div class="ml-4">
                                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="customer.name"></div>
                                                    <div class="text-sm text-gray-500 dark:text-gray-400" x-text="customer.membership || (language === 'sw' ? 'Hana usajili' : 'No membership')"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="customer.phone"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="customer.email || '-'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="customer.purchases"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatCurrency(customer.totalSpent)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button @click="editCustomer(customer)" class="text-blue-600 hover:text-blue-900 dark:hover:text-blue-400 mr-3">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button @click="viewCustomerTransactions(customer.id)" class="text-green-600 hover:text-green-900 dark:hover:text-green-400 mr-3">
                                                <i class="fas fa-receipt"></i>
                                            </button>
                                            <button @click="deleteCustomer(customer.id)" class="text-red-600 hover:text-red-900 dark:hover:text-red-400">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Loyalty Program -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                    <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Mpango wa Uaminifu' : 'Loyalty Program'"></h3>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-blue-50 dark:bg-blue-900 rounded-lg p-4">
                                <h4 class="font-medium text-blue-800 dark:text-blue-200 mb-2" x-text="language === 'sw' ? 'Wanachama' : 'Members'"></h4>
                                <p class="text-3xl font-bold text-blue-600 dark:text-blue-300" x-text="loyaltyStats.members"></p>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900 rounded-lg p-4">
                                <h4 class="font-medium text-green-800 dark:text-green-200 mb-2" x-text="language === 'sw' ? 'Pointi Zilizotolewa' : 'Points Issued'"></h4>
                                <p class="text-3xl font-bold text-green-600 dark:text-green-300" x-text="loyaltyStats.pointsIssued"></p>
                            </div>
                            <div class="bg-purple-50 dark:bg-purple-900 rounded-lg p-4">
                                <h4 class="font-medium text-purple-800 dark:text-purple-200 mb-2" x-text="language === 'sw' ? 'Pointi Zilizotumiwa' : 'Points Redeemed'"></h4>
                                <p class="text-3xl font-bold text-purple-600 dark:text-purple-300" x-text="loyaltyStats.pointsRedeemed"></p>
                            </div>
                        </div>
                        
                        <div class="mt-6">
                            <h4 class="font-medium mb-2" x-text="language === 'sw' ? 'Wateja Wenye Pointi Nyingi Zaidi' : 'Top Customers by Points'"></h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Jina' : 'Name'"></th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Simu' : 'Phone'"></th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Pointi' : 'Points'"></th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Kiwango' : 'Tier'"></th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <template x-for="customer in topCustomersByPoints" :key="customer.id">
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="customer.name"></div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="customer.phone"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="customer.points"></td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full" 
                                                          :class="{'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200': customer.tier === 'silver',
                                                                   'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200': customer.tier === 'gold',
                                                                   'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200': customer.tier === 'platinum'}">
                                                        <span x-text="language === 'sw' ? 
                                                            (customer.tier === 'silver' ? 'Fedha' : 
                                                             customer.tier === 'gold' ? 'Dhahabu' : 'Platinamu') 
                                                            : customer.tier.charAt(0).toUpperCase() + customer.tier.slice(1)"></span>
                                                    </span>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports View -->
            <div x-show="currentView === 'reports'" class="p-6 animate-fade-in">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold" x-text="language === 'sw' ? 'Ripoti na Uchambuzi' : 'Reports & Analytics'"></h2>
                    <div class="flex space-x-2">
                        <button @click="exportReport()" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded-lg">
                            <i class="fas fa-file-export mr-2"></i>
                            <span x-text="language === 'sw' ? 'Hamisha' : 'Export'"></span>
                        </button>
                        <button @click="printReport()" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded-lg">
                            <i class="fas fa-print mr-2"></i>
                            <span x-text="language === 'sw' ? 'Chapa' : 'Print'"></span>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <!-- Report Type Selector -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4">
                        <h3 class="font-medium mb-4" x-text="language === 'sw' ? 'Aina ya Ripoti' : 'Report Type'"></h3>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                <input id="sales-report" type="radio" x-model="reportType" value="sales" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600">
                                <label for="sales-report" class="ml-2 block text-sm text-gray-700 dark:text-gray-300" x-text="language === 'sw' ? 'Ripoti ya Mauzo' : 'Sales Report'"></label>
                            </div>
                            <div class="flex items-center">
                                <input id="inventory-report" type="radio" x-model="reportType" value="inventory" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600">
                                <label for="inventory-report" class="ml-2 block text-sm text-gray-700 dark:text-gray-300" x-text="language === 'sw' ? 'Ripoti ya Hifadhi' : 'Inventory Report'"></label>
                            </div>
                            <div class="flex items-center">
                                <input id="customer-report" type="radio" x-model="reportType" value="customer" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600">
                                <label for="customer-report" class="ml-2 block text-sm text-gray-700 dark:text-gray-300" x-text="language === 'sw' ? 'Ripoti ya Wateja' : 'Customer Report'"></label>
                            </div>
                            <div class="flex items-center">
                                <input id="profit-report" type="radio" x-model="reportType" value="profit" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600">
                                <label for="profit-report" class="ml-2 block text-sm text-gray-700 dark:text-gray-300" x-text="language === 'sw' ? 'Ripoti ya Faida' : 'Profit Report'"></label>
                            </div>
                        </div>
                        
                        <h3 class="font-medium mt-6 mb-4" x-text="language === 'sw' ? 'Kipindi cha Muda' : 'Time Period'"></h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button @click="setReportPeriod('today')" 
                                    :class="{'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200': reportPeriod === 'today'}"
                                    class="px-3 py-1 rounded-lg text-sm font-medium bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                                    x-text="language === 'sw' ? 'Leo' : 'Today'"></button>
                            <button @click="setReportPeriod('week')" 
                                    :class="{'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200': reportPeriod === 'week'}"
                                    class="px-3 py-1 rounded-lg text-sm font-medium bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                                    x-text="language === 'sw' ? 'Wiki hii' : 'This Week'"></button>
                            <button @click="setReportPeriod('month')" 
                                    :class="{'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200': reportPeriod === 'month'}"
                                    class="px-3 py-1 rounded-lg text-sm font-medium bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                                    x-text="language === 'sw' ? 'Mwezi huu' : 'This Month'"></button>
                            <button @click="setReportPeriod('year')" 
                                    :class="{'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200': reportPeriod === 'year'}"
                                    class="px-3 py-1 rounded-lg text-sm font-medium bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                                    x-text="language === 'sw' ? 'Mwaka huu' : 'This Year'"></button>
                            <button @click="setReportPeriod('custom')" 
                                    :class="{'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200': reportPeriod === 'custom'}"
                                    class="px-3 py-1 rounded-lg text-sm font-medium bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors col-span-2"
                                    x-text="language === 'sw' ? 'Muda Maalum' : 'Custom Period'"></button>
                        </div>
                        
                        <div x-show="reportPeriod === 'custom'" class="mt-4 space-y-2">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Kuanzia' : 'From'"></label>
                                <input type="date" x-model="customStartDate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Hadi' : 'To'"></label>
                                <input type="date" x-model="customEndDate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                        
                        <button @click="generateReport()" class="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            <span x-text="language === 'sw' ? 'Tengeneza Ripoti' : 'Generate Report'"></span>
                        </button>
                    </div>
                    
                    <!-- Report Results -->
                    <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                        <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" x-text="reportTitle"></h3>
                        </div>
                        <div class="p-4">
                            <template x-if="reportType === 'sales'">
                                <div>
                                    <div class="h-64 mb-6">
                                        <canvas id="salesReportChart"></canvas>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                            <thead class="bg-gray-50 dark:bg-gray-700">
                                                <tr>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Tarehe' : 'Date'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Idadi ya Manunuzi' : 'Transactions'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Jumla ya Mauzo' : 'Total Sales'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Wateja' : 'Customers'"></th>
                                                </tr>
                                            </thead>
                                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                                <template x-for="day in salesReportData.daily" :key="day.date">
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatDate(day.date)"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="day.transactions"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatCurrency(day.sales)"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="day.customers"></td>
                                                    </tr>
                                                </template>
                                                <tr class="bg-gray-50 dark:bg-gray-700 font-medium">
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Jumla' : 'Total'"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="salesReportData.total.transactions"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="formatCurrency(salesReportData.total.sales)"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="salesReportData.total.customers"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </template>
                            
                            <template x-if="reportType === 'inventory'">
                                <div>
                                    <div class="h-64 mb-6">
                                        <canvas id="inventoryReportChart"></canvas>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                            <thead class="bg-gray-50 dark:bg-gray-700">
                                                <tr>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Kundi' : 'Category'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Bidhaa' : 'Products'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Jumla ya Hifadhi' : 'Total Stock'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Thamani ya Hifadhi' : 'Stock Value'"></th>
                                                </tr>
                                            </thead>
                                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                                <template x-for="category in inventoryReportData.categories" :key="category.name">
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="category.name"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="category.products"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="category.stock"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatCurrency(category.value)"></td>
                                                    </tr>
                                                </template>
                                                <tr class="bg-gray-50 dark:bg-gray-700 font-medium">
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Jumla' : 'Total'"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="inventoryReportData.total.products"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="inventoryReportData.total.stock"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="formatCurrency(inventoryReportData.total.value)"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </template>
                            
                            <template x-if="reportType === 'customer'">
                                <div>
                                    <div class="h-64 mb-6">
                                        <canvas id="customerReportChart"></canvas>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                            <thead class="bg-gray-50 dark:bg-gray-700">
                                                <tr>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Mteja' : 'Customer'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Manunuzi' : 'Purchases'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Jumla ya Matumizi' : 'Total Spent'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Muda wa Mwisho' : 'Last Visit'"></th>
                                                </tr>
                                            </thead>
                                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                                <template x-for="customer in customerReportData.customers" :key="customer.id">
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap">
                                                            <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="customer.name"></div>
                                                            <div class="text-sm text-gray-500 dark:text-gray-400" x-text="customer.phone"></div>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="customer.purchases"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatCurrency(customer.totalSpent)"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatDate(customer.lastVisit)"></td>
                                                    </tr>
                                                </template>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </template>
                            
                            <template x-if="reportType === 'profit'">
                                <div>
                                    <div class="h-64 mb-6">
                                        <canvas id="profitReportChart"></canvas>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                            <thead class="bg-gray-50 dark:bg-gray-700">
                                                <tr>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Kundi' : 'Category'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Mauzo' : 'Sales'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Gharama' : 'Cost'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Faida' : 'Profit'"></th>
                                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Kiasi cha Faida' : 'Margin'"></th>
                                                </tr>
                                            </thead>
                                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                                <template x-for="category in profitReportData.categories" :key="category.name">
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="category.name"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatCurrency(category.sales)"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatCurrency(category.cost)"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatCurrency(category.profit)"></td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="category.margin + '%'"></td>
                                                    </tr>
                                                </template>
                                                <tr class="bg-gray-50 dark:bg-gray-700 font-medium">
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Jumla' : 'Total'"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="formatCurrency(profitReportData.total.sales)"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="formatCurrency(profitReportData.total.cost)"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="formatCurrency(profitReportData.total.profit)"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white" x-text="profitReportData.total.margin + '%'"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div x-show="currentView === 'settings'" class="p-6 animate-fade-in">
                <div class="mb-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold" x-text="language === 'sw' ? 'Mipangilio' : 'Settings'"></h2>
                    <button @click="saveSettings()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg">
                        <i class="fas fa-save mr-2"></i>
                        <span x-text="language === 'sw' ? 'Hifadhi Mipangilio' : 'Save Settings'"></span>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Business Settings -->
                    <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                        <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Mipangilio ya Biashara' : 'Business Settings'"></h3>
                        </div>
                        <div class="p-6 space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Jina la Biashara' : 'Business Name'"></label>
                                    <input type="text" x-model="settings.businessName" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Nambari ya Simu' : 'Phone Number'"></label>
                                    <input type="tel" x-model="settings.businessPhone" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Anwani' : 'Address'"></label>
                                <textarea x-model="settings.businessAddress" rows="2" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"></textarea>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Kodi ya Mauzo (%)' : 'Sales Tax (%)'"></label>
                                    <input type="number" x-model="settings.taxRate" step="0.01" min="0" max="100" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Nambari ya Till ya M-Pesa' : 'M-Pesa Till Number'"></label>
                                    <input type="text" x-model="settings.mpesaTill" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Sarafu' : 'Currency'"></label>
                                    <select x-model="settings.currency" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                        <option value="KES">KES - Kenyan Shilling</option>
                                        <option value="USD">USD - US Dollar</option>
                                        <option value="EUR">EUR - Euro</option>
                                        <option value="GBP">GBP - British Pound</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Settings -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                        <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Mipangilio ya Mfumo' : 'System Settings'"></h3>
                        </div>
                        <div class="p-6 space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Lugha' : 'Language'"></label>
                                <select x-model="settings.language" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    <option value="en">English</option>
                                    <option value="sw">Swahili</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Mpangilio wa Mwonekano' : 'Theme'"></label>
                                <select x-model="settings.theme" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    <option value="light" x-text="language === 'sw' ? 'Mwanga' : 'Light'"></option>
                                    <option value="dark" x-text="language === 'sw' ? 'Giza' : 'Dark'"></option>
                                    <option value="system" x-text="language === 'sw' ? 'Sanidi na Mfumo' : 'System Default'"></option>
                                </select>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300" x-text="language === 'sw' ? 'Chapisha risiti moja kwa moja' : 'Auto-print receipts'"></label>
                                    <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                        <input type="checkbox" x-model="settings.autoPrintReceipt" id="auto-print" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                        <label for="auto-print" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300" x-text="language === 'sw' ? 'Sauti za Mfumo' : 'System Sounds'"></label>
                                    <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                        <input type="checkbox" x-model="settings.soundEffects" id="sounds" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                        <label for="sounds" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300" x-text="language === 'sw' ? 'Hifadhi ya Wavuti ya Matumizi' : 'Progressive Web App'"></label>
                                    <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                        <input type="checkbox" x-model="settings.pwaEnabled" id="pwa" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                        <label for="pwa" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300" x-text="language === 'sw' ? 'Hifadhi ya Nje ya Mtandao' : 'Offline Storage'"></label>
                                    <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                        <input type="checkbox" x-model="settings.offlineStorage" id="offline" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                        <label for="offline" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Management -->
                    <div class="lg:col-span-3 bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                        <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Usimamizi wa Watumiaji' : 'User Management'"></h3>
                        </div>
                        <div class="p-6">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Jina' : 'Name'"></th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Simu' : 'Phone'"></th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Barua Pepe' : 'Email'"></th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Jukumu' : 'Role'"></th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Vitendo' : 'Actions'"></th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <template x-for="user in systemUsers" :key="user.id">
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium" x-text="user.name.charAt(0)"></div>
                                                        <div class="ml-4">
                                                            <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="user.name"></div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="user.phone"></td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="user.email || '-'"></td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full" 
                                                          :class="{'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200': user.role === 'admin',
                                                                   'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200': user.role === 'manager',
                                                                   'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200': user.role === 'cashier'}">
                                                        <span x-text="language === 'sw' ? 
                                                            (user.role === 'admin' ? 'Msimamizi' : 
                                                             user.role === 'manager' ? 'Meneja' : 'Keshia') 
                                                            : user.role.charAt(0).toUpperCase() + user.role.slice(1)"></span>
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <button @click="editUser(user)" class="text-blue-600 hover:text-blue-900 dark:hover:text-blue-400 mr-3">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button @click="deleteUser(user.id)" class="text-red-600 hover:text-red-900 dark:hover:text-red-400">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                            
                            <button @click="showAddUserModal = true" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                                <i class="fas fa-plus mr-2"></i>
                                <span x-text="language === 'sw' ? 'Mtumiaji Mpya' : 'New User'"></span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Backup & Restore -->
                    <div class="lg:col-span-3 bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                        <div class="px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Hifadhi na Rejesha Data' : 'Backup & Restore'"></h3>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                                    <h4 class="font-medium mb-4" x-text="language === 'sw' ? 'Hifadhi Data' : 'Backup Data'"></h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-4" x-text="language === 'sw' ? 'Pakua nakala ya data yako kwa usalama' : 'Download a copy of your data for safekeeping'"></p>
                                    <button @click="createBackup()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                                        <i class="fas fa-download mr-2"></i>
                                        <span x-text="language === 'sw' ? 'Hifadhi Data' : 'Backup Data'"></span>
                                    </button>
                                </div>
                                
                                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                                    <h4 class="font-medium mb-4" x-text="language === 'sw' ? 'Rejesha Data' : 'Restore Data'"></h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-4" x-text="language === 'sw' ? 'Pakia faili ya data ili kurejesha mfumo' : 'Upload a backup file to restore the system'"></p>
                                    <div>
                                        <input type="file" id="restoreFile" class="hidden" @change="handleRestoreFile">
                                        <label for="restoreFile" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors inline-block text-center cursor-pointer">
                                            <i class="fas fa-upload mr-2"></i>
                                            <span x-text="language === 'sw' ? 'Chagua Faili' : 'Choose File'"></span>
                                        </label>
                                        <button @click="restoreBackup()" :disabled="!restoreFile" :class="{'opacity-50 cursor-not-allowed': !restoreFile}" class="w-full mt-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                                            <span x-text="language === 'sw' ? 'Rejesha Data' : 'Restore Data'"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Barcode Scanner Modal -->
    <div x-show="showBarcodeScanner" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Kichanganua Msimbo' : 'Barcode Scanner'"></h3>
                            <div class="mt-4 relative">
                                <div id="barcode-scanner-container" class="w-full h-64 bg-black relative">
                                    <div class="scanner-overlay">
                                        <div class="scanner-frame"></div>
                                    </div>
                                </div>
                                <div class="mt-4 text-center">
                                    <p class="text-sm text-gray-500 dark:text-gray-400" x-text="language === 'sw' ? 'Elekeza kamera kwenye msimbo wa bidhaa' : 'Point the camera at the product barcode'"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="stopScanner()" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Funga' : 'Close'"></span>
                    </button>
                    <button @click="manualBarcodeEntry()" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-600 text-base font-medium text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Weka Msimbo Mkono' : 'Enter Barcode Manually'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div x-show="showReceiptModal" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div id="receipt-print" class="w-full max-w-md mx-auto">
                        <div class="text-center mb-4">
                            <h2 class="text-xl font-bold" x-text="settings.businessName"></h2>
                            <p class="text-sm" x-text="settings.businessAddress"></p>
                            <p class="text-sm" x-text="settings.businessPhone"></p>
                        </div>
                        
                        <div class="border-t border-b border-gray-200 py-2 my-2">
                            <div class="flex justify-between text-sm">
                                <span x-text="language === 'sw' ? 'Tarehe:' : 'Date:'"></span>
                                <span x-text="formatDate(currentTransaction.date, true)"></span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span x-text="language === 'sw' ? 'Nambari ya Risiti:' : 'Receipt No:'"></span>
                                <span x-text="currentTransaction.receiptNo"></span>
                            </div>
                            <div class="flex justify-between text-sm" x-show="currentTransaction.customer">
                                <span x-text="language === 'sw' ? 'Mteja:' : 'Customer:'"></span>
                                <span x-text="currentTransaction.customer"></span>
                            </div>
                        </div>
                        
                        <div class="my-2">
                            <template x-for="item in currentTransaction.items" :key="item.id">
                                <div class="receipt-item">
                                    <div class="flex justify-between">
                                        <span class="font-medium" x-text="item.name"></span>
                                        <span x-text="formatCurrency(item.price * item.quantity)"></span>
                                    </div>
                                    <div class="flex justify-between text-xs text-gray-500">
                                        <span x-text="item.quantity + ' Ã— ' + formatCurrency(item.price)"></span>
                                        <span x-text="item.barcode"></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-2 mt-2">
                            <div class="flex justify-between">
                                <span x-text="language === 'sw' ? 'Jumla:' : 'Subtotal:'"></span>
                                <span x-text="formatCurrency(currentTransaction.subtotal)"></span>
                            </div>
                            <div class="flex justify-between">
                                <span x-text="language === 'sw' ? 'Kodi (' + (settings.taxRate * 100) + '%):' : 'Tax (' + (settings.taxRate * 100) + '%):'"></span>
                                <span x-text="formatCurrency(currentTransaction.tax)"></span>
                            </div>
                            <div x-show="currentTransaction.discount > 0" class="flex justify-between">
                                <span x-text="language === 'sw' ? 'Punguzo:' : 'Discount:'"></span>
                                <span x-text="formatCurrency(currentTransaction.discount)"></span>
                            </div>
                            <div class="flex justify-between font-bold">
                                <span x-text="language === 'sw' ? 'Jumla ya Malipo:' : 'Total:'"></span>
                                <span x-text="formatCurrency(currentTransaction.total)"></span>
                            </div>
                            <div class="flex justify-between mt-2">
                                <span x-text="language === 'sw' ? 'Njia ya Malipo:' : 'Payment Method:'"></span>
                                <span x-text="language === 'sw' ? 
                                    (currentTransaction.paymentMethod === 'mpesa' ? 'M-Pesa' : 
                                     currentTransaction.paymentMethod === 'cash' ? 'Pesa Taslimu' : 'Kadi') 
                                    : currentTransaction.paymentMethod.charAt(0).toUpperCase() + currentTransaction.paymentMethod.slice(1)"></span>
                            </div>
                            <div x-show="currentTransaction.paymentMethod === 'mpesa'" class="flex justify-between">
                                <span>M-Pesa Code:</span>
                                <span x-text="currentTransaction.mpesaCode || 'N/A'"></span>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4 pt-2 border-t border-gray-200">
                            <p class="text-xs" x-text="language === 'sw' ? 'Asante kwa kununua nasi!' : 'Thank you for shopping with us!'"></p>
                            <p class="text-xs" x-text="language === 'sw' ? 'Karibu tena!' : 'Please come again!'"></p>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="printReceipt()" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-print mr-2"></i>
                        <span x-text="language === 'sw' ? 'Chapa Risiti' : 'Print Receipt'"></span>
                    </button>
                    <button @click="showReceiptModal = false" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Funga' : 'Close'"></span>
                    </button>
                    <button @click="sendReceipt()" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-paper-plane mr-2"></i>
                        <span x-text="language === 'sw' ? 'Tuma kwa SMS' : 'Send via SMS'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- M-Pesa Payment Modal -->
    <div x-show="showMpesaModal" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-mobile-alt text-green-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Malipo ya M-Pesa' : 'M-Pesa Payment'"></h3>
                            <div class="mt-4">
                                <p class="text-sm text-gray-500 dark:text-gray-400" x-text="language === 'sw' ? 'Weka nambari ya simu ya M-Pesa:' : 'Enter M-Pesa phone number:'"></p>
                                <div class="mt-2">
                                    <input type="tel" x-model="mpesaPhone" placeholder="254700000000" class="mpesa-input">
                                </div>
                                <div class="mt-4">
                                    <p class="text-sm font-medium" x-text="language === 'sw' ? 'Kiasi:' : 'Amount:'"></p>
                                    <p class="text-2xl font-bold" x-text="formatCurrency(cartTotal + cartTax)"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="confirmMpesaPayment()" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Tuma Malipo' : 'Send Payment'"></span>
                    </button>
                    <button @click="showMpesaModal = false" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-600 text-base font-medium text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Ghairi' : 'Cancel'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div x-show="showKeyboardShortcuts" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Vifungo vya Haraka' : 'Keyboard Shortcuts'"></h3>
                            <div class="mt-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                        <h4 class="font-medium mb-2" x-text="language === 'sw' ? 'Mauzo' : 'Sales'"></h4>
                                        <ul class="space-y-2">
                                            <li class="flex justify-between">
                                                <span class="text-sm" x-text="language === 'sw' ? 'Funga mauzo' : 'Complete sale'"></span>
                                                <span class="bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded text-xs font-mono">Enter</span>
                                            </li>
                                            <li class="flex justify-between">
                                                <span class="text-sm" x-text="language === 'sw' ? 'Malipo ya pesa taslimu' : 'Cash payment'"></span>
                                                <span class="bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded text-xs font-mono">F1</span>
                                            </li>
                                            <li class="flex justify-between">
                                                <span class="text-sm" x-text="language === 'sw' ? 'Malipo ya M-Pesa' : 'M-Pesa payment'"></span>
                                                <span class="bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded text-xs font-mono">F2</span>
                                            </li>
                                            <li class="flex justify-between">
                                                <span class="text-sm" x-text="language === 'sw' ? 'Malipo ya kadi' : 'Card payment'"></span>
                                                <span class="bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded text-xs font-mono">F3</span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                                        <h4 class="font-medium mb-2" x-text="language === 'sw' ? 'Bidhaa' : 'Products'"></h4>
                                        <ul class="space-y-2">
                                            <li class="flex justify-between">
                                                <span class="text-sm" x-text="language === 'sw' ? 'Tafuta bidhaa' : 'Search products'"></span>
                                                <span class="bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded text-xs font-mono">/</span>
                                            </li>
                                            <li class="flex justify-between">
                                                <span class="text-sm" x-text="language === 'sw' ? 'Changanua msimbo' : 'Scan barcode'"></span>
                                                <span class="bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded text-xs font-mono">F8</span>
                                            </li>
                                            <li class="flex justify-between">
                                                <span class="text-sm" x-text="language === 'sw' ? 'Onyesha msaada' : 'Show help'"></span>
                                                <span class="bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded text-xs font-mono">F12</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="showKeyboardShortcuts = false" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Sawa' : 'OK'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div x-show="showAddProductModal" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" x-text="editingProduct ? (language === 'sw' ? 'Hariri Bidhaa' : 'Edit Product') : (language === 'sw' ? 'Bidhaa Mpya' : 'New Product')"></h3>
                            <div class="mt-4 space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Jina la Bidhaa' : 'Product Name'"></label>
                                        <input type="text" x-model="productForm.name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Kundi' : 'Category'"></label>
                                        <input type="text" x-model="productForm.category" list="categories" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                        <datalist id="categories">
                                            <template x-for="category in productCategories" :key="category">
                                                <option :value="category"></option>
                                            </template>
                                        </datalist>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Bei ya Rejareja' : 'Retail Price'"></label>
                                        <input type="number" x-model="productForm.price" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Bei ya Jumla' : 'Wholesale Price'"></label>
                                        <input type="number" x-model="productForm.wholesalePrice" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Gharama' : 'Cost'"></label>
                                        <input type="number" x-model="productForm.cost" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Hifadhi' : 'Stock'"></label>
                                        <input type="number" x-model="productForm.stock" min="0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Kiwango cha Chini' : 'Minimum Stock'"></label>
                                        <input type="number" x-model="productForm.minStock" min="0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Kitengo' : 'Unit'"></label>
                                        <select x-model="productForm.unit" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                            <option value="pcs" x-text="language === 'sw' ? 'Vipande' : 'Pieces'"></option>
                                            <option value="kg" x-text="language === 'sw' ? 'Kilo' : 'Kilogram'"></option>
                                            <option value="g" x-text="language === 'sw' ? 'Gramu' : 'Gram'"></option>
                                            <option value="l" x-text="language === 'sw' ? 'Lita' : 'Liter'"></option>
                                            <option value="ml" x-text="language === 'sw' ? 'Mililita' : 'Milliliter'"></option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">SKU</label>
                                        <input type="text" x-model="productForm.sku" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Msimbo wa Mstari' : 'Barcode'"></label>
                                        <div class="flex">
                                            <input type="text" x-model="productForm.barcode" class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-l-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                            <button @click="generateBarcode()" class="bg-gray-200 dark:bg-gray-600 px-3 rounded-r-lg">
                                                <i class="fas fa-barcode"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Maelezo' : 'Description'"></label>
                                    <textarea x-model="productForm.description" rows="2" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Picha ya Bidhaa' : 'Product Image'"></label>
                                    <div class="flex items-center space-x-4">
                                        <div class="flex-shrink-0 h-20 w-20 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center overflow-hidden">
                                            <template x-if="productForm.image">
                                                <img :src="productForm.image" class="h-full w-full object-cover">
                                            </template>
                                            <template x-if="!productForm.image">
                                                <i class="fas fa-box text-gray-400 dark:text-gray-500"></i>
                                            </template>
                                        </div>
                                        <div class="flex-1">
                                            <input type="file" id="productImage" class="hidden" @change="handleProductImage">
                                            <label for="productImage" class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm text-sm font-medium bg-white dark:bg-gray-700 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer">
                                                <i class="fas fa-upload mr-2"></i>
                                                <span x-text="language === 'sw' ? 'Chagua Picha' : 'Choose Image'"></span>
                                            </label>
                                            <button x-show="productForm.image" @click="productForm.image = ''" class="ml-2 inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm text-sm font-medium bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 hover:bg-red-200 dark:hover:bg-red-800">
                                                <i class="fas fa-trash mr-2"></i>
                                                <span x-text="language === 'sw' ? 'Futa' : 'Remove'"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="saveProduct()" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Hifadhi Bidhaa' : 'Save Product'"></span>
                    </button>
                    <button @click="cancelProductEdit()" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-600 text-base font-medium text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Ghairi' : 'Cancel'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div x-show="showAddCustomerModal" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" x-text="editingCustomer ? (language === 'sw' ? 'Hariri Mteja' : 'Edit Customer') : (language === 'sw' ? 'Mteja Mpya' : 'New Customer')"></h3>
                            <div class="mt-4 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Jina Kamili' : 'Full Name'"></label>
                                    <input type="text" x-model="customerForm.name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Nambari ya Simu' : 'Phone Number'"></label>
                                        <input type="tel" x-model="customerForm.phone" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Barua Pepe' : 'Email'"></label>
                                        <input type="email" x-model="customerForm.email" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Anwani' : 'Address'"></label>
                                    <textarea x-model="customerForm.address" rows="2" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"></textarea>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Nambari ya Kitambulisho' : 'ID Number'"></label>
                                        <input type="text" x-model="customerForm.idNumber" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Tarehe ya Kuzaliwa' : 'Date of Birth'"></label>
                                        <input type="date" x-model="customerForm.dob" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Maelezo ya Ziada' : 'Additional Notes'"></label>
                                    <textarea x-model="customerForm.notes" rows="2" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="saveCustomer()" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Hifadhi Mteja' : 'Save Customer'"></span>
                    </button>
                    <button @click="cancelCustomerEdit()" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-600 text-base font-medium text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Ghairi' : 'Cancel'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div x-show="showAddUserModal" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" x-text="editingUser ? (language === 'sw' ? 'Hariri Mtumiaji' : 'Edit User') : (language === 'sw' ? 'Mtumiaji Mpya' : 'New User')"></h3>
                            <div class="mt-4 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Jina Kamili' : 'Full Name'"></label>
                                    <input type="text" x-model="userForm.name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Nambari ya Simu' : 'Phone Number'"></label>
                                        <input type="tel" x-model="userForm.phone" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Barua Pepe' : 'Email'"></label>
                                        <input type="email" x-model="userForm.email" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Jukumu' : 'Role'"></label>
                                    <select x-model="userForm.role" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                        <option value="admin" x-text="language === 'sw' ? 'Msimamizi' : 'Administrator'"></option>
                                        <option value="manager" x-text="language === 'sw' ? 'Meneja' : 'Manager'"></option>
                                        <option value="cashier" x-text="language === 'sw' ? 'Keshia' : 'Cashier'"></option>
                                    </select>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Nenosiri' : 'Password'"></label>
                                        <input type="password" x-model="userForm.password" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Thibitisha Nenosiri' : 'Confirm Password'"></label>
                                        <input type="password" x-model="userForm.confirmPassword" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="saveUser()" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Hifadhi Mtumiaji' : 'Save User'"></span>
                    </button>
                    <button @click="cancelUserEdit()" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-600 text-base font-medium text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Ghairi' : 'Cancel'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Products Modal -->
    <div x-show="showImportModal" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Ingiza Bidhaa' : 'Import Products'"></h3>
                            <div class="mt-4">
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4" x-text="language === 'sw' ? 'Chagua faili ya Excel ili kuingiza bidhaa nyingi kwa wakati mmoja' : 'Select an Excel file to import multiple products at once'"></p>
                                
                                <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center">
                                    <input type="file" id="importFile" class="hidden" @change="handleImportFile">
                                    <label for="importFile" class="cursor-pointer">
                                        <i class="fas fa-file-excel text-4xl text-green-500 mb-2"></i>
                                        <p class="text-sm text-gray-500 dark:text-gray-400" x-text="language === 'sw' ? 'Bonyeza hapa au buruta faili ya Excel' : 'Click here or drag an Excel file'"></p>
                                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-2" x-text="language === 'sw' ? 'Faili inapaswa kuwa na safu: Jina, Kundi, Bei, Hifadhi' : 'File should contain columns: Name, Category, Price, Stock'"></p>
                                    </label>
                                </div>
                                
                                <div x-show="importFile" class="mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <i class="fas fa-file-excel text-green-500 mr-2"></i>
                                            <span x-text="importFile.name"></span>
                                        </div>
                                        <button @click="importFile = null" class="text-red-500 hover:text-red-700 dark:hover:text-red-400">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="processImport()" :disabled="!importFile" :class="{'opacity-50 cursor-not-allowed': !importFile}" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Ingiza Bidhaa' : 'Import Products'"></span>
                    </button>
                    <button @click="showImportModal = false" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-600 text-base font-medium text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Ghairi' : 'Cancel'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Restock Product Modal -->
    <div x-show="showRestockModal" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Rejesha Hifadhi' : 'Restock Product'"></h3>
                            <div class="mt-4 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Bidhaa' : 'Product'"></label>
                                    <p class="font-medium" x-text="restockProductData.name"></p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Hifadhi ya Sasa' : 'Current Stock'"></label>
                                        <p x-text="restockProductData.stock"></p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Kiwango cha Chini' : 'Minimum Level'"></label>
                                        <p x-text="restockProductData.minStock || 5"></p>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Idadi ya Kuongeza' : 'Quantity to Add'"></label>
                                    <input type="number" x-model="restockQuantity" min="1" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Gharama ya Kila Kipimo' : 'Cost per Unit'"></label>
                                    <input type="number" x-model="restockCost" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="language === 'sw' ? 'Muuzaji' : 'Supplier'"></label>
                                    <select x-model="restockSupplier" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                                        <option value="" x-text="language === 'sw' ? 'Chagua Muuzaji' : 'Select Supplier'"></option>
                                        <template x-for="supplier in suppliers" :key="supplier.id">
                                            <option :value="supplier.id" x-text="supplier.name"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="confirmRestock()" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Hifadhi Rejesho' : 'Save Restock'"></span>
                    </button>
                    <button @click="showRestockModal = false" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-600 text-base font-medium text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Ghairi' : 'Cancel'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Transactions Modal -->
    <div x-show="showCustomerTransactionsModal" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" x-text="language === 'sw' ? 'Manunuzi ya Mteja' : 'Customer Transactions'"></h3>
                            <div class="mt-4">
                                <div class="flex items-center mb-4">
                                    <div class="flex-shrink-0 h-12 w-12 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium" x-text="selectedCustomer.name.charAt(0)"></div>
                                    <div class="ml-4">
                                        <h4 class="font-medium" x-text="selectedCustomer.name"></h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400" x-text="selectedCustomer.phone"></p>
                                    </div>
                                    <div class="ml-auto text-right">
                                        <p class="text-sm" x-text="language === 'sw' ? 'Jumla ya Matumizi:' : 'Total Spent:'"></p>
                                        <p class="font-bold" x-text="formatCurrency(selectedCustomer.totalSpent)"></p>
                                    </div>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Tarehe' : 'Date'"></th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Nambari ya Risiti' : 'Receipt No'"></th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Bidhaa' : 'Items'"></th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Kiasi' : 'Amount'"></th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" x-text="language === 'sw' ? 'Vitendo' : 'Actions'"></th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <template x-for="transaction in customerTransactions" :key="transaction.id">
                                                <tr>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatDate(transaction.date, true)"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="transaction.receiptNo"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="transaction.items.length"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300" x-text="formatCurrency(transaction.total)"></td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                        <button @click="viewTransaction(transaction.id)" class="text-blue-600 hover:text-blue-900 dark:hover:text-blue-400">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="showCustomerTransactionsModal = false" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <span x-text="language === 'sw' ? 'Funga' : 'Close'"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Core JavaScript -->
    <script>
        // RetailPro Kenya - Complete Application
        function retailApp() {
            return {
                // Application State
                isAuthenticated: false,
                isOnline: navigator.onLine,
                isLoading: false,
                isLoggingIn: false,
                mobileMenuOpen: false,
                userMenuOpen: false,
                branchMenuOpen: false,
                darkMode: localStorage.getItem('darkMode') === 'true',
                language: localStorage.getItem('language') || 'en',
                currentView: 'dashboard',
                showBarcodeScanner: false,
                showReceiptModal: false,
                showMpesaModal: false,
                showKeyboardShortcuts: false,
                showAddProductModal: false,
                showAddCustomerModal: false,
                showAddUserModal: false,
                showImportModal: false,
                showRestockModal: false,
                showCustomerTransactionsModal: false,
                showCustomerModal: false,
                
                // Navigation Items
                navigationItems: [
                    { id: 'dashboard', name: 'Dashboard', nameSwahili: 'Dashibodi', icon: 'fas fa-tachometer-alt' },
                    { id: 'pos', name: 'POS', nameSwahili: 'POS', icon: 'fas fa-cash-register' },
                    { id: 'inventory', name: 'Inventory', nameSwahili: 'Hifadhi', icon: 'fas fa-boxes' },
                    { id: 'customers', name: 'Customers', nameSwahili: 'Wateja', icon: 'fas fa-users' },
                    { id: 'reports', name: 'Reports', nameSwahili: 'Ripoti', icon: 'fas fa-chart-bar' },
                    { id: 'settings', name: 'Settings', nameSwahili: 'Mipangilio', icon: 'fas fa-cog' }
                ],
                
                // User Data
                user: {
                    id: '',
                    name: '',
                    phone: '',
                    email: '',
                    role: ''
                },
                
                // Branches
                branches: [
                    { id: '1', name: 'Nairobi Main Branch' },
                    { id: '2', name: 'Mombasa Branch' },
                    { id: '3', name: 'Kisumu Branch' }
                ],
                currentBranch: { id: '1', name: 'Nairobi Main Branch' },
                
                // Login Form
                loginForm: {
                    phone: '',
                    password: '',
                    remember: false
                },
                
                // Dashboard Data
                dashboardData: {
                    todaySales: 0,
                    salesChange: 0,
                    todayOrders: 0,
                    ordersChange: 0,
                    lowStockItems: 0,
                    newCustomers: 0,
                    customersChange: 0
                },
                recentTransactions: [],
                
                // POS Data
                cart: [],
                customerSearch: '',
                filteredCustomers: [],
                selectedCustomer: null,
                productSearch: '',
                activeCategory: null,
                filteredProducts: [],
                
                // Inventory Data
                inventorySearch: '',
                filteredInventory: [],
                inventoryPage: 1,
                inventoryPageSize: 10,
                lowStockItems: [],
                
                // Customer Data
                customerListSearch: '',
                filteredCustomerList: [],
                topCustomersByPoints: [],
                loyaltyStats: {
                    members: 0,
                    pointsIssued: 0,
                    pointsRedeemed: 0
                },
                
                // Reports Data
                reportType: 'sales',
                reportPeriod: 'week',
                customStartDate: '',
                customEndDate: '',
                reportTitle: '',
                salesReportData: {
                    daily: [],
                    total: {}
                },
                inventoryReportData: {
                    categories: [],
                    total: {}
                },
                customerReportData: {
                    customers: []
                },
                profitReportData: {
                    categories: [],
                    total: {}
                },
                
                // Settings Data
                settings: {
                    businessName: 'RetailPro Kenya',
                    businessPhone: '+254700000000',
                    businessAddress: 'Nairobi, Kenya',
                    currency: 'KES',
                    taxRate: 0.16,
                    mpesaTill: '123456',
                    language: 'en',
                    theme: 'system',
                    autoPrintReceipt: true,
                    soundEffects: true,
                    pwaEnabled: true,
                    offlineStorage: true
                },
                systemUsers: [],
                restoreFile: null,
                
                // Product Form
                productForm: {
                    id: '',
                    name: '',
                    category: '',
                    price: 0,
                    wholesalePrice: 0,
                    cost: 0,
                    stock: 0,
                    minStock: 5,
                    unit: 'pcs',
                    sku: '',
                    barcode: '',
                    description: '',
                    image: ''
                },
                editingProduct: false,
                
                // Customer Form
                customerForm: {
                    id: '',
                    name: '',
                    phone: '',
                    email: '',
                    address: '',
                    idNumber: '',
                    dob: '',
                    notes: ''
                },
                editingCustomer: false,
                
                // User Form
                userForm: {
                    id: '',
                    name: '',
                    phone: '',
                    email: '',
                    role: 'cashier',
                    password: '',
                    confirmPassword: ''
                },
                editingUser: false,
                
                // Import Data
                importFile: null,
                
                // Restock Data
                restockProductData: {},
                restockQuantity: 1,
                restockCost: 0,
                restockSupplier: '',
                suppliers: [
                    { id: '1', name: 'General Supplies Ltd' },
                    { id: '2', name: 'Quality Products Kenya' },
                    { id: '3', name: 'Nairobi Wholesalers' }
                ],
                
                // Customer Transactions
                selectedCustomer: {},
                customerTransactions: [],
                
                // Current Transaction
                currentTransaction: {
                    id: '',
                    receiptNo: '',
                    date: new Date(),
                    customer: '',
                    items: [],
                    subtotal: 0,
                    tax: 0,
                    discount: 0,
                    total: 0,
                    paymentMethod: '',
                    mpesaCode: ''
                },
                
                // M-Pesa Payment
                mpesaPhone: '',
                
                // Initialize the application
                init() {
                    this.checkAuth();
                    this.setupConnectivity();
                    this.loadData();
                    this.setupKeyboardShortcuts();
                    
                    // Set dark mode if enabled
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    }
                    
                    // Set language
                    this.language = this.settings.language;
                    
                    // Generate sample data if none exists
                    if (!localStorage.getItem('rp_initialized')) {
                        this.generateSampleData();
                        localStorage.setItem('rp_initialized', 'true');
                    }
                    
                    // Load charts after a short delay to allow DOM rendering
                    setTimeout(() => {
                        this.initCharts();
                    }, 300);
                },
                
                // Check authentication status
                checkAuth() {
                    const user = JSON.parse(localStorage.getItem('rp_user'));
                    if (user) {
                        this.isAuthenticated = true;
                        this.user = user;
                    }
                },
                
                // Login function
                login() {
                    this.isLoggingIn = true;
                    
                    // Simulate API call
                    setTimeout(() => {
                        // Demo authentication
                        const demoUsers = {
                            '+254700000001': { password: 'admin123', name: 'Admin User', role: 'admin', email: 'admin@retailpro.co.ke' },
                            '+254700000002': { password: 'manager123', name: 'Manager User', role: 'manager', email: 'manager@retailpro.co.ke' },
                            '+254700000003': { password: 'cashier123', name: 'Cashier User', role: 'cashier', email: 'cashier@retailpro.co.ke' }
                        };
                        
                        const user = demoUsers[this.loginForm.phone];
                        
                        if (user && this.loginForm.password === user.password) {
                            this.user = {
                                id: this.loginForm.phone,
                                name: user.name,
                                phone: this.loginForm.phone,
                                email: user.email,
                                role: user.role
                            };
                            
                            this.isAuthenticated = true;
                            localStorage.setItem('rp_user', JSON.stringify(this.user));
                            
                            this.showNotification(
                                this.language === 'sw' ? 'Umefanikiwa kuingia' : 'Login successful',
                                'success'
                            );
                        } else {
                            this.showNotification(
                                this.language === 'sw' ? 'Simu au nenosiri si sahihi' : 'Phone or password is incorrect',
                                'danger'
                            );
                        }
                        
                        this.isLoggingIn = false;
                    }, 1000);
                },
                
                // Logout function
                logout() {
                    this.isAuthenticated = false;
                    this.user = {
                        id: '',
                        name: '',
                        phone: '',
                        email: '',
                        role: ''
                    };
                    localStorage.removeItem('rp_user');
                    this.showNotification(
                        this.language === 'sw' ? 'Umefanikiwa kutoka' : 'Logout successful',
                        'success'
                    );
                },
                
                // Switch branch
                switchBranch(branchId) {
                    this.currentBranch = this.branches.find(b => b.id === branchId);
                    this.branchMenuOpen = false;
                    this.showNotification(
                        this.language === 'sw' ? 'Tawi limebadilishwa' : 'Branch switched',
                        'success'
                    );
                },
                
                // Toggle dark mode
                toggleTheme() {
                    this.darkMode = !this.darkMode;
                    localStorage.setItem('darkMode', this.darkMode);
                    
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                    
                    this.userMenuOpen = false;
                },
                
                // Toggle language
                toggleLanguage() {
                    this.language = this.language === 'en' ? 'sw' : 'en';
                    localStorage.setItem('language', this.language);
                    this.userMenuOpen = false;
                },
                
                // Setup connectivity monitoring
                setupConnectivity() {
                    window.addEventListener('online', () => {
                        this.isOnline = true;
                        this.showNotification(
                            this.language === 'sw' ? 'Umeunganishwa tena kwenye mtandao' : 'Back online',
                            'success'
                        );
                        // Sync any pending offline data
                        this.syncOfflineData();
                    });
                    
                    window.addEventListener('offline', () => {
                        this.isOnline = false;
                        this.showNotification(
                            this.language === 'sw' ? 'Huna mtandao - Data itahifadhiwa kimtaji' : 'You are offline - Data will be saved locally',
                            'warning'
                        );
                    });
                },
                
                // Sync offline data when connection is restored
                syncOfflineData() {
                    // In a real app, this would sync any locally stored data with the server
                    console.log('Syncing offline data...');
                },
                
                // Show notification
                showNotification(message, type = 'info') {
                    const notifications = document.getElementById('notifications');
                    const notification = document.createElement('div');
                    
                    const typeClasses = {
                        info: 'bg-blue-500',
                        success: 'bg-green-500',
                        warning: 'bg-yellow-500',
                        danger: 'bg-red-500'
                    };
                    
                    notification.className = `animate-slide-up ${typeClasses[type]} text-white px-4 py-3 rounded-lg shadow-lg flex items-start`;
                    notification.innerHTML = `
                        <i class="fas ${
                            type === 'danger' ? 'fa-exclamation-circle' :
                            type === 'success' ? 'fa-check-circle' :
                            type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'
                        } mt-1 mr-3"></i>
                        <div class="flex-1">${message}</div>
                        <button class="ml-4" onclick="this.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    notifications.appendChild(notification);
                    
                    // Auto-remove after 5 seconds
                    setTimeout(() => {
                        notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                        setTimeout(() => notification.remove(), 300);
                    }, 5000);
                },
                
                // Format currency
                formatCurrency(amount) {
                    return new Intl.NumberFormat(this.language === 'sw' ? 'sw-KE' : 'en-KE', {
                        style: 'currency',
                        currency: this.settings.currency,
                        minimumFractionDigits: 2
                    }).format(amount);
                },
                
                // Format date
                formatDate(date, includeTime = false) {
                    if (!date) return '';
                    
                    const options = { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric',
                        ...(includeTime && { hour: '2-digit', minute: '2-digit' })
                    };
                    return new Date(date).toLocaleDateString(this.language === 'sw' ? 'sw-KE' : 'en-KE', options);
                },
                
                // Load all data
                loadData() {
                    // Load products
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    this.filteredProducts = products;
                    this.filteredInventory = products;
                    
                    // Load customers
                    const customers = JSON.parse(localStorage.getItem('rp_customers')) || [];
                    this.filteredCustomerList = customers;
                    
                    // Load transactions
                    const transactions = JSON.parse(localStorage.getItem('rp_transactions')) || [];
                    this.recentTransactions = transactions.slice(0, 5).reverse();
                    
                    // Load settings
                    const settings = JSON.parse(localStorage.getItem('rp_settings'));
                    if (settings) {
                        this.settings = settings;
                    }
                    
                    // Load users
                    const users = JSON.parse(localStorage.getItem('rp_users')) || [];
                    this.systemUsers = users;
                    
                    // Calculate dashboard data
                    this.calculateDashboardData();
                    
                    // Calculate low stock items
                    this.calculateLowStockItems();
                    
                    // Calculate loyalty stats
                    this.calculateLoyaltyStats();
                },
                
                // Generate sample data
                generateSampleData() {
                    // Sample products
                    const sampleProducts = [
                        { 
                            id: '1', 
                            name: 'Sugar 1kg', 
                            category: 'Food', 
                            price: 120, 
                            wholesalePrice: 100,
                            cost: 80,
                            stock: 50, 
                            minStock: 10,
                            unit: 'pcs',
                            sku: 'PRD001', 
                            barcode: '123456789012',
                            description: 'Fine white sugar 1kg package',
                            image: ''
                        },       { 
                            id: '2', 
                            name: 'Rice 2kg', 
                            category: 'Food', 
                            price: 220, 
                            wholesalePrice: 180,
                            cost: 150,
                            stock: 30, 
                            minStock: 5,
                            unit: 'pcs',
                            sku: 'PRD002', 
                            barcode: '234567890123',
                            description: 'Basmati rice 2kg package',
                            image: ''
                        },
                        { 
                            id: '3', 
                            name: 'Cooking Oil 1L', 
                            category: 'Food', 
                            price: 250, 
                            wholesalePrice: 220,
                            cost: 180,
                            stock: 20, 
                            minStock: 5,
                            unit: 'pcs',
                            sku: 'PRD003', 
                            barcode: '345678901234',
                            description: 'Vegetable cooking oil 1 liter',
                            image: ''
                        },
                        { 
                            id: '4', 
                            name: 'Wheat Flour 2kg', 
                            category: 'Food', 
                            price: 150, 
                            wholesalePrice: 130,
                            cost: 100,
                            stock: 40, 
                            minStock: 10,
                            unit: 'pcs',
                            sku: 'PRD004', 
                            barcode: '456789012345',
                            description: 'All-purpose wheat flour 2kg',
                            image: ''
                        },
                        { 
                            id: '5', 
                            name: 'Tea Leaves 250g', 
                            category: 'Beverages', 
                            price: 180, 
                            wholesalePrice: 150,
                            cost: 120,
                            stock: 25, 
                            minStock: 5,
                            unit: 'pcs',
                            sku: 'PRD005', 
                            barcode: '567890123456',
                            description: 'Premium tea leaves 250g packet',
                            image: ''
                        },
                        { 
                            id: '6', 
                            name: 'Coffee 200g', 
                            category: 'Beverages', 
                            price: 350, 
                            wholesalePrice: 300,
                            cost: 250,
                            stock: 15, 
                            minStock: 5,
                            unit: 'pcs',
                            sku: 'PRD006', 
                            barcode: '678901234567',
                            description: 'Arabica coffee ground 200g',
                            image: ''
                        },
                        { 
                            id: '7', 
                            name: 'Milk Powder 400g', 
                            category: 'Dairy', 
                            price: 220, 
                            wholesalePrice: 200,
                            cost: 160,
                            stock: 18, 
                            minStock: 5,
                            unit: 'pcs',
                            sku: 'PRD007', 
                            barcode: '789012345678',
                            description: 'Full cream milk powder 400g',
                            image: ''
                        },
                        { 
                            id: '8', 
                            name: 'Toilet Paper 6 rolls', 
                            category: 'Household', 
                            price: 280, 
                            wholesalePrice: 250,
                            cost: 200,
                            stock: 22, 
                            minStock: 5,
                            unit: 'pcs',
                            sku: 'PRD008', 
                            barcode: '890123456789',
                            description: '2-ply toilet paper 6 rolls',
                            image: ''
                        },
                        { 
                            id: '9', 
                            name: 'Soap Bar', 
                            category: 'Personal Care', 
                            price: 80, 
                            wholesalePrice: 70,
                            cost: 50,
                            stock: 35, 
                            minStock: 10,
                            unit: 'pcs',
                            sku: 'PRD009', 
                            barcode: '901234567890',
                            description: 'Antibacterial soap bar',
                            image: ''
                        },
                        { 
                            id: '10', 
                            name: 'Toothpaste 100g', 
                            category: 'Personal Care', 
                            price: 120, 
                            wholesalePrice: 100,
                            cost: 80,
                            stock: 28, 
                            minStock: 5,
                            unit: 'pcs',
                            sku: 'PRD010', 
                            barcode: '012345678901',
                            description: 'Fluoride toothpaste 100g tube',
                            image: ''
                        }
                    ];
                    localStorage.setItem('rp_products', JSON.stringify(sampleProducts));
                    
                    // Sample customers
                    const sampleCustomers = [
                        { 
                            id: '1', 
                            name: 'John Doe', 
                            phone: '+254712345678', 
                            email: 'john@example.com',
                            address: '123 Main St, Nairobi',
                            idNumber: '12345678',
                            dob: '1985-05-15',
                            notes: 'Regular customer',
                            purchases: 12,
                            totalSpent: 8500,
                            lastVisit: new Date(Date.now() - 86400000).toISOString(), // yesterday
                            points: 120,
                            tier: 'silver'
                        },
                        { 
                            id: '2', 
                            name: 'Jane Smith', 
                            phone: '+254723456789', 
                            email: 'jane@example.com',
                            address: '456 Park Ave, Nairobi',
                            idNumber: '87654321',
                            dob: '1990-08-22',
                            notes: 'Likes discounts',
                            purchases: 8,
                            totalSpent: 4200,
                            lastVisit: new Date(Date.now() - 172800000).toISOString(), // 2 days ago
                            points: 80,
                            tier: 'silver'
                        },
                        { 
                            id: '3', 
                            name: 'Mike Johnson', 
                            phone: '+254734567890', 
                            email: 'mike@example.com',
                            address: '789 Oak St, Nairobi',
                            idNumber: '45678901',
                            dob: '1978-11-30',
                            notes: 'Wholesale buyer',
                            purchases: 25,
                            totalSpent: 18500,
                            lastVisit: new Date(Date.now() - 259200000).toISOString(), // 3 days ago
                            points: 250,
                            tier: 'gold'
                        },
                        { 
                            id: '4', 
                            name: 'Sarah Williams', 
                            phone: '+254745678901', 
                            email: 'sarah@example.com',
                            address: '321 Pine Rd, Nairobi',
                            idNumber: '56789012',
                            dob: '1995-03-10',
                            notes: 'New customer',
                            purchases: 3,
                            totalSpent: 1200,
                            lastVisit: new Date(Date.now() - 345600000).toISOString(), // 4 days ago
                            points: 30,
                            tier: 'silver'
                        },
                        { 
                            id: '5', 
                            name: 'David Brown', 
                            phone: '+254756789012', 
                            email: 'david@example.com',
                            address: '654 Elm Blvd, Nairobi',
                            idNumber: '67890123',
                            dob: '1982-07-18',
                            notes: 'VIP customer',
                            purchases: 42,
                            totalSpent: 32000,
                            lastVisit: new Date().toISOString(), // today
                            points: 420,
                            tier: 'platinum'
                        }
                    ];
                    localStorage.setItem('rp_customers', JSON.stringify(sampleCustomers));
                    
                    // Sample transactions
                    const sampleTransactions = [];
                    const paymentMethods = ['cash', 'mpesa', 'card'];
                    const statuses = ['completed', 'completed', 'completed', 'completed', 'pending', 'cancelled'];
                    
                    for (let i = 1; i <= 20; i++) {
                        const itemCount = Math.floor(Math.random() * 5) + 1; // 1-5 items
                        const items = [];
                        let subtotal = 0;
                        
                        for (let j = 0; j < itemCount; j++) {
                            const productIndex = Math.floor(Math.random() * sampleProducts.length);
                            const product = sampleProducts[productIndex];
                            const quantity = Math.floor(Math.random() * 3) + 1; // 1-3 quantity
                            
                            items.push({
                                id: product.id,
                                name: product.name,
                                price: product.price,
                                quantity: quantity,
                                barcode: product.barcode
                            });
                            
                            subtotal += product.price * quantity;
                        }
                        
                        const tax = subtotal * this.settings.taxRate;
                        const total = subtotal + tax;
                        const customerIndex = Math.floor(Math.random() * sampleCustomers.length);
                        const paymentMethod = paymentMethods[Math.floor(Math.random() * paymentMethods.length)];
                        
                        sampleTransactions.push({
                            id: 'T' + i.toString().padStart(4, '0'),
                            receiptNo: 'R' + (1000 + i).toString(),
                            date: new Date(Date.now() - (i * 86400000)).toISOString(), // i days ago
                            customer: sampleCustomers[customerIndex].name,
                            items: items,
                            subtotal: subtotal,
                            tax: tax,
                            discount: 0,
                            total: total,
                            paymentMethod: paymentMethod,
                            mpesaCode: paymentMethod === 'mpesa' ? 'MP' + (1000 + i).toString() : '',
                            status: statuses[Math.floor(Math.random() * statuses.length)]
                        });
                    }
                    localStorage.setItem('rp_transactions', JSON.stringify(sampleTransactions));
                    
                    // Sample users
                    const sampleUsers = [
                        {
                            id: '1',
                            name: 'Admin User',
                            phone: '+254700000001',
                            email: 'admin@retailpro.co.ke',
                            role: 'admin',
                            password: 'admin123'
                        },
                        {
                            id: '2',
                            name: 'Manager User',
                            phone: '+254700000002',
                            email: 'manager@retailpro.co.ke',
                            role: 'manager',
                            password: 'manager123'
                        },
                        {
                            id: '3',
                            name: 'Cashier User',
                            phone: '+254700000003',
                            email: 'cashier@retailpro.co.ke',
                            role: 'cashier',
                            password: 'cashier123'
                        }
                    ];
                    localStorage.setItem('rp_users', JSON.stringify(sampleUsers));
                    
                    // Sample settings
                    const sampleSettings = {
                        businessName: 'RetailPro Kenya',
                        businessPhone: '+254700000000',
                        businessAddress: 'Nairobi, Kenya',
                        currency: 'KES',
                        taxRate: 0.16,
                        mpesaTill: '123456',
                        language: 'en',
                        theme: 'system',
                        autoPrintReceipt: true,
                        soundEffects: true,
                        pwaEnabled: true,
                        offlineStorage: true
                    };
                    localStorage.setItem('rp_settings', JSON.stringify(sampleSettings));
                },
                
                // Calculate dashboard data
                calculateDashboardData() {
                    const transactions = JSON.parse(localStorage.getItem('rp_transactions')) || [];
                    const customers = JSON.parse(localStorage.getItem('rp_customers')) || [];
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    
                    // Today's sales
                    const today = new Date().toISOString().split('T')[0];
                    const todayTransactions = transactions.filter(t => 
                        t.date.split('T')[0] === today && t.status === 'completed'
                    );
                    this.dashboardData.todaySales = todayTransactions.reduce((sum, t) => sum + t.total, 0);
                    
                    // Yesterday's sales for comparison
                    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                    const yesterdayTransactions = transactions.filter(t => 
                        t.date.split('T')[0] === yesterday && t.status === 'completed'
                    );
                    const yesterdaySales = yesterdayTransactions.reduce((sum, t) => sum + t.total, 0);
                    
                    // Sales change percentage
                    this.dashboardData.salesChange = yesterdaySales > 0 ? 
                        Math.round(((this.dashboardData.todaySales - yesterdaySales) / yesterdaySales) * 100) : 100;
                    
                    // Today's orders
                    this.dashboardData.todayOrders = todayTransactions.length;
                    
                    // Yesterday's orders for comparison
                    const yesterdayOrders = yesterdayTransactions.length;
                    this.dashboardData.ordersChange = yesterdayOrders > 0 ? 
                        Math.round(((this.dashboardData.todayOrders - yesterdayOrders) / yesterdayOrders) * 100) : 100;
                    
                    // Low stock items
                    this.dashboardData.lowStockItems = products.filter(p => 
                        p.stock <= (p.minStock || 5)
                    ).length;
                    
                    // New customers this month
                    const currentMonth = new Date().getMonth();
                    const currentYear = new Date().getFullYear();
                    this.dashboardData.newCustomers = customers.filter(c => {
                        const customerDate = new Date(c.lastVisit || c.dob || new Date());
                        return customerDate.getMonth() === currentMonth && 
                               customerDate.getFullYear() === currentYear;
                    }).length;
                    
                    // Customer change from last month
                    const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
                    const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
                    const lastMonthCustomers = customers.filter(c => {
                        const customerDate = new Date(c.lastVisit || c.dob || new Date());
                        return customerDate.getMonth() === lastMonth && 
                               customerDate.getFullYear() === lastMonthYear;
                    }).length;
                    
                    this.dashboardData.customersChange = lastMonthCustomers > 0 ? 
                        Math.round(((this.dashboardData.newCustomers - lastMonthCustomers) / lastMonthCustomers) * 100) : 100;
                },
                
                // Calculate low stock items
                calculateLowStockItems() {
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    this.lowStockItems = products.filter(p => 
                        p.stock <= (p.minStock || 5)
                    ).map(p => ({
                        id: p.id,
                        name: p.name,
                        sku: p.sku,
                        stock: p.stock,
                        minStock: p.minStock || 5
                    }));
                },
                
                // Calculate loyalty stats
                calculateLoyaltyStats() {
                    const customers = JSON.parse(localStorage.getItem('rp_customers')) || [];
                    
                    this.loyaltyStats.members = customers.filter(c => c.points > 0).length;
                    this.loyaltyStats.pointsIssued = customers.reduce((sum, c) => sum + (c.points || 0), 0);
                    this.loyaltyStats.pointsRedeemed = customers.reduce((sum, c) => sum + (c.pointsRedeemed || 0), 0);
                    
                    // Top customers by points
                    this.topCustomersByPoints = [...customers]
                        .filter(c => c.points > 0)
                        .sort((a, b) => b.points - a.points)
                        .slice(0, 5);
                },
                
                // Initialize charts
                initCharts() {
                    // Sales Chart
                    const salesCtx = document.getElementById('salesChart');
                    if (salesCtx) {
                        this.salesChart = new Chart(salesCtx, {
                            type: 'line',
                            data: {
                                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                                datasets: [{
                                    label: this.language === 'sw' ? 'Mauzo' : 'Sales',
                                    data: [12000, 19000, 15000, 18000, 21000, 25000, 22000, 24000, 23000, 26000, 28000, 30000],
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    borderColor: 'rgba(59, 130, 246, 1)',
                                    borderWidth: 2,
                                    tension: 0.3,
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: (value) => this.formatCurrency(value).replace(/[^\d.,]/g, '')
                                        }
                                    }
                                }
                            }
                        });
                    }
                    
                    // Inventory Chart
                    const inventoryCtx = document.getElementById('inventoryChart');
                    if (inventoryCtx) {
                        this.inventoryChart = new Chart(inventoryCtx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Food', 'Beverages', 'Dairy', 'Household', 'Personal Care'],
                                datasets: [{
                                    data: [35, 25, 15, 10, 15],
                                    backgroundColor: [
                                        'rgba(59, 130, 246, 0.7)',
                                        'rgba(16, 185, 129, 0.7)',
                                        'rgba(245, 158, 11, 0.7)',
                                        'rgba(139, 92, 246, 0.7)',
                                        'rgba(236, 72, 153, 0.7)'
                                    ],
                                    borderColor: [
                                        'rgba(59, 130, 246, 1)',
                                        'rgba(16, 185, 129, 1)',
                                        'rgba(245, 158, 11, 1)',
                                        'rgba(139, 92, 246, 1)',
                                        'rgba(236, 72, 153, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'right'
                                    }
                                }
                            }
                        });
                    }
                },
                
                // Update sales chart based on range
                updateSalesChart() {
                    if (!this.salesChart) return;
                    
                    let labels, data;
                    const transactions = JSON.parse(localStorage.getItem('rp_transactions')) || [];
                    
                    if (this.salesChartRange === '7') {
                        // Last 7 days
                        labels = [];
                        data = [];
                        
                        for (let i = 6; i >= 0; i--) {
                            const date = new Date();
                            date.setDate(date.getDate() - i);
                            const dateStr = date.toISOString().split('T')[0];
                            labels.push(this.formatDate(dateStr));
                            
                            const daySales = transactions
                                .filter(t => t.date.split('T')[0] === dateStr && t.status === 'completed')
                                .reduce((sum, t) => sum + t.total, 0);
                            data.push(daySales);
                        }
                    } else if (this.salesChartRange === '30') {
                        // Last 30 days by week
                        labels = [];
                        data = [];
                        
                        for (let i = 3; i >= 0; i--) {
                            const weekStart = new Date();
                            weekStart.setDate(weekStart.getDate() - (i + 1) * 7);
                            const weekEnd = new Date();
                            weekEnd.setDate(weekEnd.getDate() - i * 7);
                            
                            labels.push(`Week ${4 - i}`);
                            
                            const weekSales = transactions
                                .filter(t => {
                                    const tDate = new Date(t.date);
                                    return tDate >= weekStart && tDate < weekEnd && t.status === 'completed';
                                })
                                .reduce((sum, t) => sum + t.total, 0);
                            data.push(weekSales);
                        }
                    } else {
                        // Last 90 days by month
                        labels = [];
                        data = [];
                        
                        for (let i = 2; i >= 0; i--) {
                            const month = new Date();
                            month.setMonth(month.getMonth() - i);
                            const monthName = month.toLocaleString(this.language === 'sw' ? 'sw-KE' : 'en-KE', { month: 'short' });
                            labels.push(monthName);
                            
                            const monthSales = transactions
                                .filter(t => {
                                    const tDate = new Date(t.date);
                                    return tDate.getMonth() === month.getMonth() && 
                                           tDate.getFullYear() === month.getFullYear() && 
                                           t.status === 'completed';
                                })
                                .reduce((sum, t) => sum + t.total, 0);
                            data.push(monthSales);
                        }
                    }
                    
                    this.salesChart.data.labels = labels;
                    this.salesChart.data.datasets[0].data = data;
                    this.salesChart.update();
                },
                
                // Refresh inventory chart
                refreshInventoryChart() {
                    if (!this.inventoryChart) return;
                    
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    const categories = [...new Set(products.map(p => p.category))];
                    
                    const data = categories.map(cat => 
                        products.filter(p => p.category === cat).length
                    );
                    
                    this.inventoryChart.data.labels = categories;
                    this.inventoryChart.data.datasets[0].data = data;
                    this.inventoryChart.update();
                    
                    this.showNotification(
                        this.language === 'sw' ? 'Chati ya hifadhi imesasishwa' : 'Inventory chart updated',
                        'success'
                    );
                },
                
                // Refresh dashboard data
                refreshDashboard() {
                    this.calculateDashboardData();
                    this.updateSalesChart();
                    this.showNotification(
                        this.language === 'sw' ? 'Dashibodi imesasishwa' : 'Dashboard refreshed',
                        'success'
                    );
                },
                
                // Export dashboard data
                exportDashboardData() {
                    const data = {
                        todaySales: this.dashboardData.todaySales,
                        todayOrders: this.dashboardData.todayOrders,
                        lowStockItems: this.dashboardData.lowStockItems,
                        newCustomers: this.dashboardData.newCustomers,
                        recentTransactions: this.recentTransactions
                    };
                    
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    saveAs(blob, `dashboard-export-${new Date().toISOString().split('T')[0]}.json`);
                    
                    this.showNotification(
                        this.language === 'sw' ? 'Data ya dashibodi imehamishwa' : 'Dashboard data exported',
                        'success'
                    );
                },
                
                // POS Functions
                searchProducts() {
                    const searchTerm = this.productSearch.toLowerCase();
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    
                    this.filteredProducts = products.filter(p => 
                        (p.name.toLowerCase().includes(searchTerm) || 
                         p.sku.toLowerCase().includes(searchTerm) || 
                         p.barcode.includes(searchTerm)) &&
                        (this.activeCategory ? p.category === this.activeCategory : true)
                    );
                },
                
                setActiveCategory(category) {
                    this.activeCategory = category;
                    this.searchProducts();
                },
                
                addToCart(product) {
                    // Check if product already in cart
                    const existingItem = this.cart.find(item => item.product.id === product.id);
                    
                    if (existingItem) {
                        existingItem.quantity += 1;
                    } else {
                        this.cart.push({
                            product: product,
                            quantity: 1
                        });
                    }
                    
                    // Play sound effect if enabled
                    if (this.settings.soundEffects) {
                        this.playSound('add-to-cart');
                    }
                },
                
                removeFromCart(index) {
                    this.cart.splice(index, 1);
                    
                    // Play sound effect if enabled
                    if (this.settings.soundEffects) {
                        this.playSound('remove-from-cart');
                    }
                },
                
                updateQuantity(index, newQuantity) {
                    if (newQuantity < 1) return;
                    this.cart[index].quantity = newQuantity;
                },
                
                validateQuantity(index) {
                    if (this.cart[index].quantity < 1) {
                        this.cart[index].quantity = 1;
                    }
                },
                
                clearCart() {
                    this.cart = [];
                    this.selectedCustomer = null;
                    this.customerSearch = '';
                    
                    // Play sound effect if enabled
                    if (this.settings.soundEffects) {
                        this.playSound('clear-cart');
                    }
                },
                
                get cartTotal() {
                    return this.cart.reduce((sum, item) => sum + (item.product.price * item.quantity), 0);
                },
                
                get cartTax() {
                    return this.cartTotal * this.settings.taxRate;
                },
                
                get productCategories() {
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    return [...new Set(products.map(p => p.category))].sort();
                },
                
                searchCustomers() {
                    const searchTerm = this.customerSearch.toLowerCase();
                    const customers = JSON.parse(localStorage.getItem('rp_customers')) || [];
                    
                    this.filteredCustomers = customers.filter(c => 
                        c.name.toLowerCase().includes(searchTerm) || 
                        c.phone.includes(searchTerm)
                    ).slice(0, 5);
                },
                
                selectCustomer(customer) {
                    this.selectedCustomer = customer;
                    this.customerSearch = customer.name;
                    this.filteredCustomers = [];
                    
                    // Play sound effect if enabled
                    if (this.settings.soundEffects) {
                        this.playSound('select-customer');
                    }
                },
                
                applyDiscount(percent) {
                    // In a real app, this would apply discount to the cart
                    this.showNotification(
                        this.language === 'sw' ? `Punguzo la ${percent}% limewekwa` : `${percent}% discount applied`,
                        'success'
                    );
                    
                    // Play sound effect if enabled
                    if (this.settings.soundEffects) {
                        this.playSound('apply-discount');
                    }
                },
                
                processPayment(method) {
                    if (this.cart.length === 0) {
                        this.showNotification(
                            this.language === 'sw' ? 'Hakuna bidhaa kwenye kikapu' : 'No products in cart',
                            'warning'
                        );
                        return;
                    }
                    
                    if (method === 'mpesa') {
                        this.showMpesaModal = true;
                        return;
                    }
                    
                    // For cash and card, complete the transaction
                    this.completeTransaction(method);
                },
                
                completeTransaction(paymentMethod, mpesaCode = '') {
                    // Generate receipt number
                    const transactions = JSON.parse(localStorage.getItem('rp_transactions')) || [];
                    const receiptNo = 'R' + (1000 + transactions.length + 1).toString();
                    
                    // Create transaction
                    const transaction = {
                        id: 'T' + (transactions.length + 1).toString().padStart(4, '0'),
                        receiptNo: receiptNo,
                        date: new Date().toISOString(),
                        customer: this.selectedCustomer ? this.selectedCustomer.name : null,
                        items: this.cart.map(item => ({
                            id: item.product.id,
                            name: item.product.name,
                            price: item.product.price,
                            quantity: item.quantity,
                            barcode: item.product.barcode
                        })),
                        subtotal: this.cartTotal,
                        tax: this.cartTax,
                        discount: 0,
                        total: this.cartTotal + this.cartTax,
                        paymentMethod: paymentMethod,
                        mpesaCode: mpesaCode,
                        status: 'completed'
                    };
                    
                    // Update product stock
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    this.cart.forEach(cartItem => {
                        const product = products.find(p => p.id === cartItem.product.id);
                        if (product) {
                            product.stock -= cartItem.quantity;
                        }
                    });
                    localStorage.setItem('rp_products', JSON.stringify(products));
                    
                    // Update customer data if exists
                    if (this.selectedCustomer) {
                        const customers = JSON.parse(localStorage.getItem('rp_customers')) || [];
                        const customer = customers.find(c => c.id === this.selectedCustomer.id);
                        if (customer) {
                            customer.purchases = (customer.purchases || 0) + 1;
                            customer.totalSpent = (customer.totalSpent || 0) + transaction.total;
                            customer.lastVisit = new Date().toISOString();
                            customer.points = (customer.points || 0) + Math.floor(transaction.total / 100); // 1 point per 100 spent
                            
                            localStorage.setItem('rp_customers', JSON.stringify(customers));
                        }
                    }
                                        // Save transaction
                    transactions.push(transaction);
                    localStorage.setItem('rp_transactions', JSON.stringify(transactions));
                    
                    // Update dashboard data
                    this.calculateDashboardData();
                    this.calculateLowStockItems();
                    this.calculateLoyaltyStats();
                    
                    // Set current transaction for receipt
                    this.currentTransaction = transaction;
                    
                    // Clear cart
                    this.cart = [];
                    this.selectedCustomer = null;
                    this.customerSearch = '';
                    
                    // Show receipt
                    this.showReceiptModal = true;
                    this.showMpesaModal = false;
                    
                    // Auto-print if enabled
                    if (this.settings.autoPrintReceipt) {
                        setTimeout(() => {
                            this.printReceipt();
                        }, 500);
                    }
                    
                    // Play sound effect if enabled
                    if (this.settings.soundEffects) {
                        this.playSound('transaction-complete');
                    }
                },
                
                confirmMpesaPayment() {
                    if (!this.mpesaPhone) {
                        this.showNotification(
                            this.language === 'sw' ? 'Tafadhali weka nambari ya simu' : 'Please enter phone number',
                            'warning'
                        );
                        return;
                    }
                    
                    // Simulate M-Pesa payment
                    this.isLoading = true;
                    
                    setTimeout(() => {
                        this.isLoading = false;
                        const mpesaCode = 'MP' + Math.floor(1000 + Math.random() * 9000);
                        this.completeTransaction('mpesa', mpesaCode);
                        this.showNotification(
                            this.language === 'sw' ? 'Malipo ya M-Pesa yamefanikiwa' : 'M-Pesa payment successful',
                            'success'
                        );
                    }, 2000);
                },
                
                printReceipt() {
                    // Use html2canvas to capture receipt and print
                    const receiptElement = document.getElementById('receipt-print');
                    
                    html2canvas(receiptElement).then(canvas => {
                        const dataUrl = canvas.toDataURL();
                        const windowContent = `
                            <!DOCTYPE html>
                            <html>
                            <head>
                                <title>Print Receipt</title>
                                <style>
                                    body { margin: 0; padding: 0; }
                                    img { width: 100%; height: auto; }
                                </style>
                            </head>
                            <body>
                                <img src="${dataUrl}" onload="window.print();window.close()">
                            </body>
                            </html>
                        `;
                        
                        const printWindow = window.open('', '_blank');
                        printWindow.document.open();
                        printWindow.document.write(windowContent);
                        printWindow.document.close();
                    });
                    
                    this.showNotification(
                        this.language === 'sw' ? 'Risiti inachapishwa' : 'Receipt printing',
                        'success'
                    );
                },
                
                sendReceipt() {
                    if (!this.currentTransaction.customer) {
                        this.showNotification(
                            this.language === 'sw' ? 'Hakuna mteja aliyeteuliwa' : 'No customer selected',
                            'warning'
                        );
                        return;
                    }
                    
                    // Simulate sending receipt via SMS
                    this.isLoading = true;
                    
                    setTimeout(() => {
                        this.isLoading = false;
                        this.showNotification(
                            this.language === 'sw' ? 'Risiti imetumwa kwa mteja' : 'Receipt sent to customer',
                            'success'
                        );
                    }, 1500);
                },
                
                openBarcodeScanner() {
                    this.showBarcodeScanner = true;
                    
                    // Initialize barcode scanner
                    setTimeout(() => {
                        Quagga.init({
                            inputStream: {
                                name: "Live",
                                type: "LiveStream",
                                target: document.querySelector('#barcode-scanner-container'),
                                constraints: {
                                    width: 480,
                                    height: 320,
                                    facingMode: "environment"
                                },
                            },
                            decoder: {
                                readers: ["ean_reader", "ean_8_reader", "code_128_reader", "upc_reader"]
                            }
                        }, function(err) {
                            if (err) {
                                console.error(err);
                                return;
                            }
                            Quagga.start();
                        });
                        
                        Quagga.onDetected((result) => {
                            const code = result.codeResult.code;
                            this.handleBarcodeScan(code);
                            Quagga.stop();
                            this.showBarcodeScanner = false;
                        });
                    }, 300);
                },
                
                stopScanner() {
                    if (Quagga) {
                        Quagga.stop();
                    }
                    this.showBarcodeScanner = false;
                },
                
                manualBarcodeEntry() {
                    const code = prompt(this.language === 'sw' ? 'Weka msimbo wa bidhaa:' : 'Enter product barcode:');
                    if (code) {
                        this.handleBarcodeScan(code);
                        this.showBarcodeScanner = false;
                    }
                },
                
                handleBarcodeScan(code) {
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    const product = products.find(p => p.barcode === code);
                    
                    if (product) {
                        this.addToCart(product);
                        this.showNotification(
                            this.language === 'sw' ? 'Bidhaa imeongezwa kwenye kikapu' : 'Product added to cart',
                            'success'
                        );
                    } else {
                        this.showNotification(
                            this.language === 'sw' ? 'Bidhaa haijapatikana' : 'Product not found',
                            'warning'
                        );
                    }
                },
                
                // Inventory Functions
                searchInventory() {
                    const searchTerm = this.inventorySearch.toLowerCase();
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    
                    this.filteredInventory = products.filter(p => 
                        p.name.toLowerCase().includes(searchTerm) || 
                        p.sku.toLowerCase().includes(searchTerm) || 
                        p.barcode.includes(searchTerm)
                    );
                    
                    this.inventoryPage = 1;
                },
                
                nextInventoryPage() {
                    if (this.inventoryPage * this.inventoryPageSize < this.filteredInventory.length) {
                        this.inventoryPage++;
                    }
                },
                
                prevInventoryPage() {
                    if (this.inventoryPage > 1) {
                        this.inventoryPage--;
                    }
                },
                
                exportInventory() {
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    const data = products.map(p => ({
                        Name: p.name,
                        Category: p.category,
                        SKU: p.sku,
                        Barcode: p.barcode,
                        Price: p.price,
                        'Wholesale Price': p.wholesalePrice,
                        Cost: p.cost,
                        Stock: p.stock,
                        'Min Stock': p.minStock,
                        Unit: p.unit,
                        Description: p.description
                    }));
                    
                    const worksheet = XLSX.utils.json_to_sheet(data);
                    const workbook = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(workbook, worksheet, "Inventory");
                    XLSX.writeFile(workbook, `inventory-export-${new Date().toISOString().split('T')[0]}.xlsx`);
                    
                    this.showNotification(
                        this.language === 'sw' ? 'Hifadhi imehamishwa' : 'Inventory exported',
                        'success'
                    );
                },
                
                addNewProduct() {
                    this.productForm = {
                        id: '',
                        name: '',
                        category: '',
                        price: 0,
                        wholesalePrice: 0,
                        cost: 0,
                        stock: 0,
                        minStock: 5,
                        unit: 'pcs',
                        sku: '',
                        barcode: '',
                        description: '',
                        image: ''
                    };
                    this.editingProduct = false;
                    this.showAddProductModal = true;
                },
                
                editProduct(product) {
                    this.productForm = { ...product };
                    this.editingProduct = true;
                    this.showAddProductModal = true;
                },
                
                saveProduct() {
                    if (!this.productForm.name || !this.productForm.category || !this.productForm.price) {
                        this.showNotification(
                            this.language === 'sw' ? 'Tafadhali jaza sehemu muhimu' : 'Please fill required fields',
                            'warning'
                        );
                        return;
                    }
                    
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    
                    if (this.editingProduct) {
                        // Update existing product
                        const index = products.findIndex(p => p.id === this.productForm.id);
                        if (index !== -1) {
                            products[index] = this.productForm;
                        }
                    } else {
                        // Add new product
                        this.productForm.id = 'P' + (products.length + 1).toString().padStart(4, '0');
                        products.push(this.productForm);
                    }
                    
                    localStorage.setItem('rp_products', JSON.stringify(products));
                    
                    // Update UI
                    this.filteredProducts = products;
                    this.filteredInventory = products;
                    this.calculateLowStockItems();
                    
                    this.showNotification(
                        this.language === 'sw' ? 'Bidhaa imehifadhiwa' : 'Product saved',
                        'success'
                    );
                    
                    this.showAddProductModal = false;
                },
                
                deleteProduct(id) {
                    if (confirm(this.language === 'sw' ? 'Una uhakika unataka kufuta bidhaa hii?' : 'Are you sure you want to delete this product?')) {
                        const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                        const updatedProducts = products.filter(p => p.id !== id);
                        
                        localStorage.setItem('rp_products', JSON.stringify(updatedProducts));
                        
                        // Update UI
                        this.filteredProducts = updatedProducts;
                        this.filteredInventory = updatedProducts;
                        this.calculateLowStockItems();
                        
                        this.showNotification(
                            this.language === 'sw' ? 'Bidhaa imefutwa' : 'Product deleted',
                            'success'
                        );
                    }
                },
                
                generateBarcode() {
                    if (!this.productForm.sku) {
                        this.showNotification(
                            this.language === 'sw' ? 'Tafadhali weka SKU ya bidhaa' : 'Please enter product SKU',
                            'warning'
                        );
                        return;
                    }
                    
                    // Simple barcode generation from SKU
                    this.productForm.barcode = this.productForm.sku.padStart(12, '0');
                    this.showNotification(
                        this.language === 'sw' ? 'Msimbo wa mstari umeundwa' : 'Barcode generated',
                        'success'
                    );
                },
                
                handleProductImage(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.productForm.image = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                },
                
                cancelProductEdit() {
                    this.showAddProductModal = false;
                },
                
                restockProduct(product) {
                    this.restockProductData = { ...product };
                    this.restockQuantity = 1;
                    this.restockCost = product.cost || 0;
                    this.restockSupplier = '';
                    this.showRestockModal = true;
                },
                
                confirmRestock() {
                    if (this.restockQuantity < 1) {
                        this.showNotification(
                            this.language === 'sw' ? 'Idadi ya kuongeza lazima iwe zaidi ya 0' : 'Quantity must be greater than 0',
                            'warning'
                        );
                        return;
                    }
                    
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    const product = products.find(p => p.id === this.restockProductData.id);
                    
                    if (product) {
                        product.stock += parseInt(this.restockQuantity);
                        if (this.restockCost > 0) {
                            product.cost = this.restockCost;
                        }
                        
                        localStorage.setItem('rp_products', JSON.stringify(products));
                        
                        // Update UI
                        this.filteredProducts = products;
                        this.filteredInventory = products;
                        this.calculateLowStockItems();
                        
                        this.showNotification(
                            this.language === 'sw' ? 'Hifadhi imesasishwa' : 'Stock updated',
                            'success'
                        );
                        
                        this.showRestockModal = false;
                    }
                },
                
                handleImportFile(event) {
                    this.importFile = event.target.files[0];
                },
                
                processImport() {
                    if (!this.importFile) return;
                    
                    this.isLoading = true;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                            
                            const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                            let newProducts = [];
                            
                            jsonData.forEach((item, index) => {
                                const newProduct = {
                                    id: 'P' + (products.length + index + 1).toString().padStart(4, '0'),
                                    name: item.Name || `Product ${index + 1}`,
                                    category: item.Category || 'Uncategorized',
                                    price: item.Price || 0,
                                    wholesalePrice: item['Wholesale Price'] || item.Price || 0,
                                    cost: item.Cost || 0,
                                    stock: item.Stock || 0,
                                    minStock: item['Min Stock'] || 5,
                                    unit: item.Unit || 'pcs',
                                    sku: item.SKU || `SKU${index + 1}`,
                                    barcode: item.Barcode || '',
                                    description: item.Description || '',
                                    image: ''
                                };
                                
                                newProducts.push(newProduct);
                            });
                            
                            const updatedProducts = [...products, ...newProducts];
                            localStorage.setItem('rp_products', JSON.stringify(updatedProducts));
                            
                            // Update UI
                            this.filteredProducts = updatedProducts;
                            this.filteredInventory = updatedProducts;
                            this.calculateLowStockItems();
                            
                            this.showNotification(
                                this.language === 'sw' ? `Bidhaa ${newProducts.length} zimeingizwa` : `${newProducts.length} products imported`,
                                'success'
                            );
                            
                            this.isLoading = false;
                            this.showImportModal = false;
                            this.importFile = null;
                        } catch (error) {
                            console.error(error);
                            this.showNotification(
                                this.language === 'sw' ? 'Hitilafu katika kuingiza data' : 'Error importing data',
                                'danger'
                            );
                            this.isLoading = false;
                        }
                    };
                    reader.readAsArrayBuffer(this.importFile);
                },
                
                // Customer Functions
                searchCustomerList() {
                    const searchTerm = this.customerListSearch.toLowerCase();
                    const customers = JSON.parse(localStorage.getItem('rp_customers')) || [];
                    
                    this.filteredCustomerList = customers.filter(c => 
                        c.name.toLowerCase().includes(searchTerm) || 
                        c.phone.includes(searchTerm) ||
                        (c.email && c.email.toLowerCase().includes(searchTerm))
                    );
                },
                
                exportCustomers() {
                    const customers = JSON.parse(localStorage.getItem('rp_customers')) || [];
                    const data = customers.map(c => ({
                        Name: c.name,
                        Phone: c.phone,
                        Email: c.email,
                        Address: c.address,
                        'ID Number': c.idNumber,
                        'Date of Birth': c.dob,
                        Notes: c.notes,
                        Purchases: c.purchases,
                        'Total Spent': c.totalSpent,
                        Points: c.points,
                        Tier: c.tier
                    }));
                    
                    const worksheet = XLSX.utils.json_to_sheet(data);
                    const workbook = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(workbook, worksheet, "Customers");
                    XLSX.writeFile(workbook, `customers-export-${new Date().toISOString().split('T')[0]}.xlsx`);
                    
                    this.showNotification(
                        this.language === 'sw' ? 'Wateja wamehamishwa' : 'Customers exported',
                        'success'
                    );
                },
                
                addNewCustomer() {
                    this.customerForm = {
                        id: '',
                        name: '',
                        phone: '',
                        email: '',
                        address: '',
                        idNumber: '',
                        dob: '',
                        notes: ''
                    };
                    this.editingCustomer = false;
                    this.showAddCustomerModal = true;
                },
                
                editCustomer(customer) {
                    this.customerForm = { ...customer };
                    this.editingCustomer = true;
                    this.showAddCustomerModal = true;
                },
                
                saveCustomer() {
                    if (!this.customerForm.name || !this.customerForm.phone) {
                        this.showNotification(
                            this.language === 'sw' ? 'Tafadhali jaza jina na nambari ya simu' : 'Please fill name and phone',
                            'warning'
                        );
                        return;
                    }
                    
                    const customers = JSON.parse(localStorage.getItem('rp_customers')) || [];
                    
                    if (this.editingCustomer) {
                        // Update existing customer
                        const index = customers.findIndex(c => c.id === this.customerForm.id);
                        if (index !== -1) {
                            customers[index] = this.customerForm;
                        }
                    } else {
                        // Add new customer
                        this.customerForm.id = 'C' + (customers.length + 1).toString().padStart(4, '0');
                        this.customerForm.purchases = 0;
                        this.customerForm.totalSpent = 0;
                        this.customerForm.points = 0;
                        this.customerForm.tier = 'silver';
                        this.customerForm.lastVisit = new Date().toISOString();
                        customers.push(this.customerForm);
                    }
                    
                    localStorage.setItem('rp_customers', JSON.stringify(customers));
                    
                    // Update UI
                    this.filteredCustomerList = customers;
                    this.calculateLoyaltyStats();
                    
                    this.showNotification(
                        this.language === 'sw' ? 'Mteja amehifadhiwa' : 'Customer saved',
                        'success'
                    );
                    
                    this.showAddCustomerModal = false;
                },
                
                deleteCustomer(id) {
                    if (confirm(this.language === 'sw' ? 'Una uhakika unataka kufuta mteja huyu?' : 'Are you sure you want to delete this customer?')) {
                        const customers = JSON.parse(localStorage.getItem('rp_customers')) || [];
                        const updatedCustomers = customers.filter(c => c.id !== id);
                        
                        localStorage.setItem('rp_customers', JSON.stringify(updatedCustomers));
                        
                        // Update UI
                        this.filteredCustomerList = updatedCustomers;
                        this.calculateLoyaltyStats();
                        
                        this.showNotification(
                            this.language === 'sw' ? 'Mteja amefutwa' : 'Customer deleted',
                            'success'
                        );
                    }
                },
                
                viewCustomerTransactions(id) {
                    const customers = JSON.parse(localStorage.getItem('rp_customers')) || [];
                    const transactions = JSON.parse(localStorage.getItem('rp_transactions')) || [];
                    
                    this.selectedCustomer = customers.find(c => c.id === id);
                    this.customerTransactions = transactions
                        .filter(t => t.customer === this.selectedCustomer.name)
                        .sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    this.showCustomerTransactionsModal = true;
                },
                
                cancelCustomerEdit() {
                    this.showAddCustomerModal = false;
                },
                
                // User Management Functions
                addNewUser() {
                    this.userForm = {
                        id: '',
                        name: '',
                        phone: '',
                        email: '',
                        role: 'cashier',
                        password: '',
                        confirmPassword: ''
                    };
                    this.editingUser = false;
                    this.showAddUserModal = true;
                },
                
                editUser(user) {
                    this.userForm = { ...user };
                    this.userForm.password = '';
                    this.userForm.confirmPassword = '';
                    this.editingUser = true;
                    this.showAddUserModal = true;
                },
                
                saveUser() {
                    if (!this.userForm.name || !this.userForm.phone || !this.userForm.role) {
                        this.showNotification(
                            this.language === 'sw' ? 'Tafadhali jaza sehemu muhimu' : 'Please fill required fields',
                            'warning'
                        );
                        return;
                    }
                    
                    if (!this.editingUser && (!this.userForm.password || this.userForm.password !== this.userForm.confirmPassword)) {
                        this.showNotification(
                            this.language === 'sw' ? 'Nenosiri halifanani' : 'Passwords do not match',
                            'warning'
                        );
                        return;
                    }
                    
                    const users = JSON.parse(localStorage.getItem('rp_users')) || [];
                    
                    if (this.editingUser) {
                        // Update existing user
                        const index = users.findIndex(u => u.id === this.userForm.id);
                        if (index !== -1) {
                            // Only update password if provided
                            if (this.userForm.password && this.userForm.password === this.userForm.confirmPassword) {
                                users[index] = this.userForm;
                            } else {
                                const { password, confirmPassword, ...userData } = this.userForm;
                                users[index] = { ...users[index], ...userData };
                            }
                        }
                    } else {
                        // Add new user
                        this.userForm.id = 'U' + (users.length + 1).toString().padStart(4, '0');
                        users.push(this.userForm);
                    }
                    
                    localStorage.setItem('rp_users', JSON.stringify(users));
                    
                    // Update UI
                    this.systemUsers = users;
                    
                    this.showNotification(
                        this.language === 'sw' ? 'Mtumiaji amehifadhiwa' : 'User saved',
                        'success'
                    );
                    
                    this.showAddUserModal = false;
                },
                
                deleteUser(id) {
                    if (confirm(this.language === 'sw' ? 'Una uhakika unataka kufuta mtumiaji huyu?' : 'Are you sure you want to delete this user?')) {
                        const users = JSON.parse(localStorage.getItem('rp_users')) || [];
                        const updatedUsers = users.filter(u => u.id !== id);
                        
                        localStorage.setItem('rp_users', JSON.stringify(updatedUsers));
                        
                        // Update UI
                        this.systemUsers = updatedUsers;
                        
                        this.showNotification(
                            this.language === 'sw' ? 'Mtumiaji amefutwa' : 'User deleted',
                            'success'
                        );
                    }
                },
                
                cancelUserEdit() {
                    this.showAddUserModal = false;
                },
                
                // Reports Functions
                setReportPeriod(period) {
                    this.reportPeriod = period;
                    
                    // Set default custom dates if needed
                    if (period === 'custom' && !this.customStartDate) {
                        const today = new Date();
                        const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
                        
                        this.customStartDate = lastMonth.toISOString().split('T')[0];
                        this.customEndDate = today.toISOString().split('T')[0];
                    }
                },
                
                generateReport() {
                    const transactions = JSON.parse(localStorage.getItem('rp_transactions')) || [];
                    const products = JSON.parse(localStorage.getItem('rp_products')) || [];
                    const customers = JSON.parse(localStorage.getItem('rp_customers')) || [];
                    
                    // Determine date range
                    let startDate, endDate;
                    const today = new Date();
                    
                    switch (this.reportPeriod) {
                        case 'today':
                            startDate = new Date(today);
                            endDate = new Date(today);
                            break;
                        case 'week':
                            startDate = new Date(today);
                            startDate.setDate(today.getDate() - 7);
                            endDate = new Date(today);
                            break;
                        case 'month':
                            startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                            endDate = new Date(today);
                            break;
                        case 'year':
                            startDate = new Date(today.getFullYear(), 0, 1);
                            endDate = new Date(today);
                            break;
                        case 'custom':
                            startDate = new Date(this.customStartDate);
                            endDate = new Date(this.customEndDate);
                            break;
                        default:
                            startDate = new Date(today);
                            startDate.setDate(today.getDate() - 7);
                            endDate = new Date(today);
                    }
                    
                    // Set report title
                    const format = { year: 'numeric', month: 'long', day: 'numeric' };
                    this.reportTitle = `${this.language === 'sw' ? 'Ripoti ya' : 'Report for'} ${this.reportType} (${startDate.toLocaleDateString(this.language, format)} - ${endDate.toLocaleDateString(this.language, format)})`;
                    
                    // Filter transactions by date range
                    const filteredTransactions = transactions.filter(t => {
                        const tDate = new Date(t.date);
                        return tDate >= startDate && tDate <= endDate && t.status === 'completed';
                    });
                    
                    // Generate report based on type
                    switch (this.reportType) {
                        case 'sales':
                            this.generateSalesReport(filteredTransactions, startDate, endDate);
                            break;
                        case 'inventory':
                            this.generateInventoryReport(products);
                            break;
                        case 'customer':
                            this.generateCustomerReport(customers, filteredTransactions);
                            break;
                        case 'profit':
                            this.generateProfitReport(filteredTransactions, products);
                            break;
                    }
                },
                
                generateSalesReport(transactions, startDate, endDate) {
                    const dailyData = [];
                    const total = {
                        transactions: 0,
                        sales: 0,
                        customers: 0
                    };
                    
                    // Group by day
                    const dateRange = [];
                    const currentDate = new Date(startDate);
                    
                    while (currentDate <= endDate) {
                        dateRange.push(new Date(currentDate));
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    
                    dateRange.forEach(date => {
                        const dateStr = date.toISOString().split('T')[0];
                        const dayTransactions = transactions.filter(t => t.date.split('T')[0] === dateStr);
                        
                        const dayCustomers = [...new Set(dayTransactions.map(t => t.customer))].filter(c => c).length;
                        
                        dailyData.push({
                            date: dateStr,
                            transactions: dayTransactions.length,
                            sales: dayTransactions.reduce((sum, t) => sum + t.total, 0),
                            customers: dayCustomers
                        });
                        
                        total.transactions += dayTransactions.length;
                        total.sales += dayTransactions.reduce((sum, t) => sum + t.total, 0);
                        total.customers += dayCustomers;
                    });
                    
                    this.salesReportData = {
                        daily: dailyData,
                        total: total
                    };
                    
                    // Update chart
                    this.updateSalesReportChart();
                },
                
                updateSalesReportChart() {
                    const salesReportCtx = document.getElementById('salesReportChart');
                    if (!salesReportCtx) return;
                    
                    if (this.salesReportChart) {
                        this.salesReportChart.destroy();
                    }
                    
                    const labels = this.salesReportData.daily.map(d => this.formatDate(d.date));
                    const data = this.salesReportData.daily.map(d => d.sales);
                    
                    this.salesReportChart = new Chart(salesReportCtx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: this.language === 'sw' ? 'Mauzo' : 'Sales',
                                data: data,
                                backgroundColor: 'rgba(59, 130, 246, 0.7)',
                                borderColor: 'rgba(59, 130, 246, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: (value) => this.formatCurrency(value).replace(/[^\d.,]/g, '')
                                    }
                                }
                            }
                        }
                    });
                },
                
                generateInventoryReport(products) {
                    const categories = [...new Set(products.map(p => p.category))];
                    
                    const categoryData = categories.map(cat => {
                        const catProducts = products.filter(p => p.category === cat);
                        return {
                            name: cat,
                            products: catProducts.length,
                            stock: catProducts.reduce((sum, p) => sum + p.stock, 0),
                            value: catProducts.reduce((sum, p) => sum + (p.price * p.stock), 0)
                        };
                    });
                    
                    this.inventoryReportData = {
                        categories: categoryData,
                        total: {
                            products: products.length,
                            stock: products.reduce((sum, p) => sum + p.stock, 0),
                            value: products.reduce((sum, p) => sum + (p.price * p.stock), 0)
                        }
                    };
                    
                    // Update chart
                    this.updateInventoryReportChart();
                },
                
                updateInventoryReportChart() {
                    const inventoryReportCtx = document.getElementById('inventoryReportChart');
                    if (!inventoryReportCtx) return;
                    
                    if (this.inventoryReportChart) {
                        this.inventoryReportChart.destroy();
                    }
                    
                    const labels = this.inventoryReportData.categories.map(c => c.name);
                    const data = this.inventoryReportData.categories.map(c => c.value);
                    
                    this.inventoryReportChart = new Chart(inventoryReportCtx, {
                        type: 'doughnut',
                        data: {
                            labels: labels,
                            datasets: [{
                                data: data,
                                backgroundColor: [
                                    'rgba(59, 130, 246, 0.7)',
                                    'rgba(16, 185, 129, 0.7)',
                                    'rgba(245, 158, 11, 0.7)',
                                    'rgba(139, 92, 246, 0.7)',
                                    'rgba(236, 72, 153, 0.7)',
                                    'rgba(220, 38, 38, 0.7)',
                                    'rgba(5, 150, 105, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(59, 130, 246, 1)',
                                    'rgba(16, 185, 129, 1)',
                                    'rgba(245, 158, 11, 1)',
                                    'rgba(139, 92, 246, 1)',
                                    'rgba(236, 72, 153, 1)',
                                    'rgba(220, 38, 38, 1)',
                                    'rgba(5, 150, 105, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right'
                                }
                            }
                        }
                    });
                },
                
                generateCustomerReport(customers, transactions) {
                    // Get top 20 customers by total spent
                    const customerMap = new Map();
                    
                    transactions.forEach(t => {
                        if (!t.customer) return;
                        
                        if (!customerMap.has(t.customer)) {
                            const customer = customers.find(c => c.name === t.customer) || {
                                name: t.customer,
                                phone: '',
                                purchases: 0,
                                totalSpent: 0,
                                lastVisit: t.date
                            };
                            
                            customerMap.set(t.customer, {
                                ...customer,
                                purchases: 0,
                                totalSpent: 0
                            });
                        }
                        
                        const customerData = customerMap.get(t.customer);
                        customerData.purchases += 1;
                        customerData.totalSpent += t.total;
                        
                        if (new Date(t.date) > new Date(customerData.lastVisit)) {
                            customerData.lastVisit = t.date;
                        }
                    });
                    
                    this.customerReportData = {
                        customers: Array.from(customerMap.values())
                            .sort((a, b) => b.totalSpent - a.totalSpent)
                            .slice(0, 20)
                    };
                    
                    // Update chart
                    this.updateCustomerReportChart();
                },
                
                updateCustomerReportChart() {
                    const customerReportCtx = document.getElementById('customerReportChart');
                    if (!customerReportCtx) return;
                    
                    if (this.customerReportChart) {
                        this.customerReportChart.destroy();
                    }
                    
                    const customers = this.customerReportData.customers.slice(0, 10);
                    const labels = customers.map(c => c.name);
                    const data = customers.map(c => c.totalSpent);
                    
                    this.customerReportChart = new Chart(customerReportCtx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: this.language === 'sw' ? 'Jumla ya Matumizi' : 'Total Spent',
                                data: data,
                                backgroundColor: 'rgba(16, 185, 129, 0.7)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            indexAxis: 'y',
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: (value) => this.formatCurrency(value).replace(/[^\d.,]/g, '')
                                    }
                                }
                            }
                        }
                    });
                },
                
                generateProfitReport(transactions, products) {
                    const categories = [...new Set(products.map(p => p.category))];
                    
                    const categoryData = categories.map(cat => {
                        const catProducts = products.filter(p => p.category === cat);
                        const catTransactions = transactions.filter(t => 
                            t.items.some(i => {
                                const product = products.find(p => p.id === i.id);
                                return product && product.category === cat;
                            })
                        );
                        
                        const sales = catTransactions.reduce((sum, t) => {
                            return sum + t.items.reduce((itemSum, i) => {
                                const product = products.find(p => p.id === i.id);
                                if (product && product.category === cat) {
                                    return itemSum + (i.price * i.quantity);
                                }
                                return itemSum;
                            }, 0);
                        }, 0);
                        
                        const cost = catTransactions.reduce((sum, t) => {
                            return sum + t.items.reduce((itemSum, i) => {
                                const product = products.find(p => p.id === i.id);
                                if (product && product.category === cat) {
                                    return itemSum + (product.cost * i.quantity);
                                }
                                return itemSum;
                            }, 0);
                        }, 0);
                        
                        const profit = sales - cost;
                        const margin = sales > 0 ? Math.round((profit / sales) * 100) : 0;
                        
                        return {
                            name: cat,
                            sales: sales,
                            cost: cost,
                            profit: profit,
                            margin: margin
                        };
                    });
                    
                    const totalSales = categoryData.reduce((sum, c) => sum + c.sales, 0);
                    const totalCost = categoryData.reduce((sum, c) => sum + c.cost, 0);
                    const totalProfit = totalSales - totalCost;
                    const totalMargin = totalSales > 0 ? Math.round((totalProfit / totalSales) * 100) : 0;
                    
                    this.profitReportData = {
                        categories: categoryData,
                        total: {
                            sales: totalSales,
                            cost: totalCost,
                            profit: totalProfit,
                            margin: totalMargin
                        }
                    };
                    
                    // Update chart
                    this.updateProfitReportChart();
                },
                
                updateProfitReportChart() {
    const profitReportCtx = document.getElementById('profitReportChart');
    if (!profitReportCtx) return;
    
    if (this.profitReportChart) {
        this.profitReportChart.destroy();
    }
    
    const labels = this.profitReportData.categories.map(c => c.name);
    const profitData = this.profitReportData.categories.map(c => c.profit);
    const marginData = this.profitReportData.categories.map(c => c.margin);
    
    this.profitReportChart = new Chart(profitReportCtx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: this.language === 'sw' ? 'Faida' : 'Profit',
                    data: profitData,
                    backgroundColor: 'rgba(16, 185, 129, 0.7)',
                    borderColor: 'rgba(16, 185, 129, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: this.language === 'sw' ? 'Kiasi cha Faida (%)' : 'Margin (%)',
                    data: marginData,
                    backgroundColor: 'rgba(59, 130, 246, 0.7)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    borderWidth: 1,
                    type: 'line',
                    yAxisID: 'y1'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    ticks: {
                        callback: (value) => this.formatCurrency(value).replace(/[^\d.,]/g, '')
                    }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    min: 0,
                    max: 100,
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        callback: (value) => value + '%'
                    }
                }
            }
        }
    });
},

exportReport() {
    let data, fileName;
    
    switch (this.reportType) {
        case 'sales':
            data = this.salesReportData;
            fileName = 'sales-report';
            break;
        case 'inventory':
            data = this.inventoryReportData;
            fileName = 'inventory-report';
            break;
        case 'customer':
            data = this.customerReportData;
            fileName = 'customer-report';
            break;
        case 'profit':
            data = this.profitReportData;
            fileName = 'profit-report';
            break;
    }
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    saveAs(blob, `${fileName}-${new Date().toISOString().split('T')[0]}.json`);
    
    this.showNotification(
        this.language === 'sw' ? 'Ripoti imehamishwa' : 'Report exported',
        'success'
    );
},

printReport() {
    const reportElement = document.querySelector('.bg-white.rounded-lg.shadow.overflow-hidden');
    
    if (!reportElement) {
        this.showNotification(
            this.language === 'sw' ? 'Hakuna ripoti ya kuchapisha' : 'No report to print',
            'warning'
        );
        return;
    }
    
    html2canvas(reportElement).then(canvas => {
        const dataUrl = canvas.toDataURL();
        const windowContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <title>Print Report</title>
                <style>
                    body { margin: 0; padding: 0; }
                    img { width: 100%; height: auto; }
                </style>
            </head>
            <body>
                <img src="${dataUrl}" onload="window.print();window.close()">
            </body>
            </html>
        `;
        
        const printWindow = window.open('', '_blank');
        printWindow.document.open();
        printWindow.document.write(windowContent);
        printWindow.document.close();
    });
    
    this.showNotification(
        this.language === 'sw' ? 'Ripoti inachapishwa' : 'Report printing',
        'success'
    );
},

// Settings Functions
saveSettings() {
    localStorage.setItem('rp_settings', JSON.stringify(this.settings));
    
    // Update language if changed
    if (this.language !== this.settings.language) {
        this.language = this.settings.language;
        localStorage.setItem('language', this.language);
    }
    
    // Update theme if changed
    const newDarkMode = this.settings.theme === 'dark' || 
                       (this.settings.theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
    
    if (newDarkMode !== this.darkMode) {
        this.darkMode = newDarkMode;
        localStorage.setItem('darkMode', this.darkMode);
        
        if (this.darkMode) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    }
    
    this.showNotification(
        this.language === 'sw' ? 'Mipangilio imehifadhiwa' : 'Settings saved',
        'success'
    );
},

createBackup() {
    const backupData = {
        products: JSON.parse(localStorage.getItem('rp_products')) || [],
        customers: JSON.parse(localStorage.getItem('rp_customers')) || [],
        transactions: JSON.parse(localStorage.getItem('rp_transactions')) || [],
        users: JSON.parse(localStorage.getItem('rp_users')) || [],
        settings: JSON.parse(localStorage.getItem('rp_settings')) || {},
        timestamp: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
    saveAs(blob, `retailpro-backup-${new Date().toISOString().split('T')[0]}.json`);
    
    this.showNotification(
        this.language === 'sw' ? 'Nakala ya data imehifadhiwa' : 'Backup created',
        'success'
    );
},

handleRestoreFile(event) {
    this.restoreFile = event.target.files[0];
},

restoreBackup() {
    if (!this.restoreFile) return;
    
    if (!confirm(this.language === 'sw' ? 
        'Una uhakika unataka kurejesha data? Hii itafuta data yako ya sasa!' : 
        'Are you sure you want to restore data? This will overwrite your current data!')) {
        return;
    }
    
    this.isLoading = true;
    
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const backupData = JSON.parse(e.target.result);
            
            if (backupData.products) localStorage.setItem('rp_products', JSON.stringify(backupData.products));
            if (backupData.customers) localStorage.setItem('rp_customers', JSON.stringify(backupData.customers));
            if (backupData.transactions) localStorage.setItem('rp_transactions', JSON.stringify(backupData.transactions));
            if (backupData.users) localStorage.setItem('rp_users', JSON.stringify(backupData.users));
            if (backupData.settings) {
                localStorage.setItem('rp_settings', JSON.stringify(backupData.settings));
                this.settings = backupData.settings;
            }
            
            // Reload all data
            this.loadData();
            
            this.showNotification(
                this.language === 'sw' ? 'Data imerejeshwa kikamilifu' : 'Data restored successfully',
                'success'
            );
            
            this.isLoading = false;
            this.restoreFile = null;
        } catch (error) {
            console.error(error);
            this.showNotification(
                this.language === 'sw' ? 'Hitilafu katika kurejesha data' : 'Error restoring data',
                'danger'
            );
            this.isLoading = false;
        }
    };
    reader.readAsText(this.restoreFile);
},

// Transaction Functions
viewTransaction(id) {
    const transactions = JSON.parse(localStorage.getItem('rp_transactions')) || [];
    this.currentTransaction = transactions.find(t => t.id === id);
    
    if (this.currentTransaction) {
        this.showReceiptModal = true;
    }
},

// Utility Functions
playSound(type) {
    if (!this.settings.soundEffects) return;
    
    const sounds = {
        'add-to-cart': 'https://assets.mixkit.co/sfx/preview/mixkit-coin-win-notification-1992.mp3',
        'remove-from-cart': 'https://assets.mixkit.co/sfx/preview/mixkit-trash-notification-1910.mp3',
        'clear-cart': 'https://assets.mixkit.co/sfx/preview/mixkit-arcade-retro-notification-225.mp3',
        'transaction-complete': 'https://assets.mixkit.co/sfx/preview/mixkit-cash-register-purchase-880.mp3',
        'select-customer': 'https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3',
        'apply-discount': 'https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3'
    };
    
    if (sounds[type]) {
        const audio = new Audio(sounds[type]);
        audio.play();
    }
},

setupKeyboardShortcuts() {
    document.addEventListener('keydown', (e) => {
        // Only handle shortcuts when POS view is active
        if (this.currentView !== 'pos') return;
        
        // Ignore if typing in an input field
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
        
        switch (e.key) {
            case 'Enter':
                if (this.cart.length > 0) {
                    this.processPayment('cash');
                }
                break;
            case '/':
                e.preventDefault();
                document.querySelector('input[type="text"][x-model="productSearch"]').focus();
                break;
            case 'F1':
                this.processPayment('cash');
                break;
            case 'F2':
                this.processPayment('mpesa');
                break;
            case 'F3':
                this.processPayment('card');
                break;
            case 'F8':
                this.openBarcodeScanner();
                break;
            case 'F12':
                this.showKeyboardShortcuts = true;
                break;
        }
    });
}

};

retailApp();
}
</script>
</body> 
</html>